<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Insight Engine – EU Space Data Assistant (Desktop Prototype)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --eu-blue: #004494;
      --eu-blue-dark: #002766;
      --eu-yellow: #ffd617;
      --bg-gradient: radial-gradient(circle at top, #041331 0%, #020617 55%, #000 100%);
      --panel-bg-alt: #07162f;
      --text-main: #f9fafb;
      --text-muted: #d1ddff;
      --text-soft: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.35);
      --border-strong: rgba(148, 163, 184, 0.75);
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.7);
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-gradient);
      color: var(--text-main);
      height: 100%;
      overscroll-behavior: none;
    }

    body { overflow: hidden; }

    .app-shell {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .header-ribbon {
      height: 3px;
      background: linear-gradient(
        to right,
        var(--eu-yellow),
        var(--eu-yellow),
        transparent 32%,
        transparent 68%,
        var(--eu-yellow),
        var(--eu-yellow)
      );
    }

    .app-header {
      display: flex;
      flex-direction: column;
      border-bottom: 1px solid var(--border-subtle);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
      background:
        radial-gradient(circle at top left, rgba(0, 68, 148, 0.6), transparent 50%),
        linear-gradient(to right, #020817, #030f2e);
      backdrop-filter: blur(18px);
      z-index: 10;
    }

    .app-header-main {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px 6px;
    }

    .app-header-sub {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px 10px;
      font-size: 10px;
      color: var(--text-soft);
      border-top: 1px solid rgba(15, 23, 42, 0.65);
      background: linear-gradient(to right, rgba(1, 8, 23, 0.9), rgba(5, 19, 49, 0.85));
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-emblem {
      width: 40px;
      height: 26px;
      border-radius: 3px;
      border: 1px solid rgba(15, 23, 42, 0.7);
      background:
        radial-gradient(circle at 50% 15%, rgba(255, 255, 255, 0.25), transparent 55%),
        linear-gradient(to bottom, var(--eu-blue), #00307a);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .brand-emblem-stars {
      font-size: 11px;
      color: var(--eu-yellow);
      letter-spacing: 0.04em;
    }

    .brand-text-title {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .brand-text-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    .badge-strip {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 11px;
    }

    .badge {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.65);
      background: rgba(4, 15, 39, 0.96);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.25);
    }

    .badge-pill {
      background: rgba(0, 68, 148, 0.17);
      border-color: rgba(0, 68, 148, 0.8);
      color: #e5f0ff;
    }

    .user-pill {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(4, 15, 39, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.65);
    }

    .user-avatar {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #ffffff, #ffd617);
      color: #00113b;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
    }

    .user-meta {
      display: flex;
      flex-direction: column;
      font-size: 11px;
      color: var(--text-muted);
    }

    .user-meta span:first-child { color: var(--text-main); }

    .header-sub-left {
      display: flex;
      align-items: center;
      gap: 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .header-sub-badges {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .header-sub-badge {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(4, 15, 39, 0.9);
      color: var(--text-soft);
      font-size: 10px;
    }

    .layout-main {
      flex: 1;
      display: grid;
      grid-template-columns: 270px 1fr 1.2fr;
      gap: 12px;
      padding: 12px;
      max-height: calc(100vh - 84px);
    }

    .panel {
      background: radial-gradient(circle at top left, var(--panel-bg-alt), #020617);
      border-radius: 22px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 14px;
      display: flex;
      flex-direction: column;
      min-height: 0;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(0, 68, 148, 0.16), transparent 60%),
        radial-gradient(circle at 120% 120%, rgba(0, 68, 148, 0.12), transparent 60%);
      opacity: 0.85;
      pointer-events: none;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      flex: 1;
    }

    .panel h2 {
      margin: 0 0 6px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .panel h2 span {
      font-size: 11px;
      font-weight: 500;
      color: var(--text-muted);
      letter-spacing: 0.04em;
      text-transform: none;
    }

    .sidebar-section { margin-top: 10px; }

    .sidebar-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
      margin-bottom: 5px;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 11px;
      color: var(--text-soft);
      background: rgba(4, 15, 39, 0.94);
      cursor: pointer;
      transition: 0.16s all ease-out;
      white-space: nowrap;
    }

    .chip:hover {
      border-color: var(--border-strong);
      transform: translateY(-1px);
    }

    .chip.chip-active {
      background: linear-gradient(to right, var(--eu-blue), var(--eu-blue-dark));
      border-color: transparent;
      color: #e5f0ff;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.8);
    }

    .status-pill {
      margin-top: 8px;
      padding: 5px 9px;
      border-radius: 999px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(22, 163, 74, 0.12);
      border: 1px solid rgba(34, 197, 94, 0.5);
      color: #bbf7d0;
    }

    .status-pill svg { width: 13px; height: 13px; }

    .sidebar-note {
      margin-top: 4px;
      font-size: 10px;
      color: var(--text-soft);
      line-height: 1.45;
    }

    .chat-panel { display: flex; flex-direction: column; gap: 8px; }

    .chat-header-title {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .chat-header-sub {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 4px;
    }

    .chat-body {
      flex: 1;
      overflow-y: auto;
      margin-top: 4px;
      padding: 8px 6px 6px;
      border-radius: 14px;
      background:
        radial-gradient(circle at top left, rgba(0, 68, 148, 0.24), transparent 52%),
        radial-gradient(circle at bottom right, rgba(15, 23, 42, 0.9), #020617);
      border: 1px solid rgba(15, 23, 42, 0.9);
    }

    .message-group { margin-bottom: 10px; }

    .message-meta {
      font-size: 10px;
      color: var(--text-soft);
      margin-bottom: 3px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .message-meta span:first-child {
      font-weight: 500;
      color: var(--text-muted);
    }

    .message-bubble {
      max-width: 100%;
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 12px;
      line-height: 1.45;
      border: 1px solid rgba(15, 23, 42, 0.9);
      background: rgba(4, 15, 39, 0.96);
    }

    .message-bubble.assistant {
      background: linear-gradient(135deg, rgba(0, 68, 148, 0.22), rgba(4, 15, 39, 0.98));
      border-color: rgba(0, 68, 148, 0.9);
    }

    .chat-input-area {
      border-radius: 14px;
      padding: 7px 9px;
      background: rgba(4, 15, 39, 0.96);
      border: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }

    .chat-input-row {
      display: flex;
      gap: 8px;
      align-items: flex-end;
    }

    .chat-input {
      flex: 1;
      border-radius: 10px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background:
        radial-gradient(circle at top left, rgba(0, 68, 148, 0.25), rgba(4, 15, 39, 0.98));
      color: var(--text-main);
      padding: 7px 10px;
      font-size: 12px;
      resize: none;
      max-height: 80px;
      outline: none;
    }

    .chat-input::placeholder { color: var(--text-soft); }

    .btn-send {
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      background: linear-gradient(to right, var(--eu-blue), var(--eu-blue-dark));
      color: #f9fafb;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.85);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-send svg { width: 13px; height: 13px; }

    .chat-footnote {
      font-size: 10px;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-footnote span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .canvas-panel { display: flex; flex-direction: column; gap: 8px; }

    .canvas-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 2px;
    }

    .canvas-title {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .canvas-sub {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 3px;
      max-width: 320px;
    }

    .pill-ai-label {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: rgba(4, 15, 39, 0.96);
      font-size: 10px;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .pill-ai-label svg { width: 11px; height: 11px; }

    .canvas-body {
      flex: 1;
      border-radius: 14px;
      border: 1px solid rgba(15, 23, 42, 0.9);
      background:
        radial-gradient(circle at top right, rgba(0, 68, 148, 0.25), #020617);
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: hidden;
    }

    .canvas-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 10px;
      color: var(--text-soft);
      padding: 2px 2px 4px;
      gap: 8px;
    }

    .canvas-meta-row span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .canvas-meta-badges {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .meta-badge {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(4, 15, 39, 0.9);
      font-size: 9px;
      color: var(--text-soft);
    }

    .canvas-scroll {
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
      margin-top: 2px;
    }

    .canvas-card {
      padding: 8px 9px;
      border-radius: 12px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: rgba(4, 15, 39, 0.97);
      margin-bottom: 7px;
      font-size: 12px;
    }

    .canvas-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .canvas-card-title { font-size: 12px; font-weight: 600; }
    .canvas-card-sub { font-size: 10px; color: var(--text-soft); }

    .canvas-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 6px;
    }

    .tag {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 9px;
      color: var(--text-soft);
    }

    .tag-accent {
      border-color: rgba(0, 68, 148, 0.95);
      color: #dbeafe;
      background: rgba(0, 68, 148, 0.22);
    }

    .hint-bar {
      font-size: 10px;
      color: var(--text-soft);
      padding-top: 4px;
      border-top: 1px dashed rgba(55, 65, 81, 0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .hint-bar span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* DASHBOARD MOCKUP */

    .dash-card {
      margin-top: 2px;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: radial-gradient(circle at top, rgba(0, 68, 148, 0.22), rgba(4, 15, 39, 0.97));
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .dash-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      font-size: 11px;
      gap: 8px;
    }

    .dash-header-left { display: flex; flex-direction: column; gap: 2px; }
    .dash-title { font-size: 12px; font-weight: 600; }
    .dash-subtitle { font-size: 10px; color: var(--text-soft); }

    .dash-header-right {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: nowrap;
    }

    .dash-filter {
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 10px;
      background: rgba(4, 15, 39, 0.95);
      color: var(--text-soft);
      white-space: nowrap;
    }

    .dash-body {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 8px;
      margin-top: 4px;
    }

    .dash-map-mini {
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: radial-gradient(circle at top, rgba(22, 163, 74, 0.12), rgba(4, 15, 39, 0.9));
      padding: 6px;
      font-size: 9px;
      color: var(--text-soft);
    }

    .dash-map-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .dash-map-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 2px;
      margin-top: 6px;
    }

    .dash-cell {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 2px;
      background: rgba(15, 23, 42, 0.9);
    }

    .dash-cell.high { background: #b91c1c; }
    .dash-cell.medium { background: #f97316; }
    .dash-cell.low { background: #22c55e; }

    .dash-kpis {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
    }

    .kpi { padding: 5px; border-radius: 8px; border: 1px solid rgba(55, 65, 81, 0.9); background: rgba(4, 15, 39, 0.9); font-size: 10px; }
    .kpi-label { color: var(--text-soft); margin-bottom: 2px; }
    .kpi-value { font-size: 13px; font-weight: 600; }
    .kpi-trend { font-size: 10px; color: #bbf7d0; }
    .kpi-trend.down { color: #fecaca; }

    .dash-chart {
      margin-top: 4px;
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(4, 15, 39, 0.94);
      padding: 4px 6px 6px;
      font-size: 9px;
      color: var(--text-soft);
    }

    .chart-bars {
      display: flex;
      align-items: flex-end;
      gap: 4px;
      height: 48px;
      margin-top: 4px;
    }

    .chart-bar {
      flex: 1;
      border-radius: 3px 3px 0 0;
      background: linear-gradient(to top, rgba(248, 113, 113, 0.9), rgba(251, 191, 36, 0.8));
    }

    .chart-bar.low {
      background: linear-gradient(to top, rgba(52, 211, 153, 0.8), rgba(56, 189, 248, 0.8));
    }

    .chart-x-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 2px;
    }

    .chart-x-labels span { font-size: 8px; color: var(--text-soft); }

    .dash-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
      font-size: 9px;
      color: var(--text-soft);
      gap: 10px;
      flex-wrap: nowrap;
    }

    .dash-footer span {
      flex: 1;
      min-width: 0;
    }

    .dash-export {
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(4, 15, 39, 0.95);
      cursor: pointer;
      font-size: 9px;
      white-space: nowrap;
      align-self: flex-end;
    }

    /* VIDEO MOCKUP */

    .video-layout {
      display: grid;
      grid-template-columns: 1.05fr 1fr;
      gap: 8px;
      margin-top: 4px;
    }

    .video-player {
      border-radius: 10px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background:
        radial-gradient(circle at top left, rgba(37, 99, 235, 0.25), transparent 55%),
        radial-gradient(circle at bottom right, rgba(8, 47, 73, 0.5), #020617);
      padding: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 10px;
    }

    .video-frame {
      position: relative;
      border-radius: 8px;
      background: linear-gradient(135deg, #0f172a, #0369a1);
      height: 120px;
      overflow: hidden;
    }

    .video-play-btn {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 30px;
      height: 30px;
      border-radius: 999px;
      border: 1px solid rgba(248, 250, 252, 0.9);
      background: rgba(15, 23, 42, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .video-play-btn::before {
      content: "";
      border-style: solid;
      border-width: 6px 0 6px 9px;
      border-color: transparent transparent transparent #e5e7eb;
      margin-left: 1px;
    }

    .video-caption-overlay {
      position: absolute;
      left: 8px;
      bottom: 8px;
      padding: 3px 6px;
      border-radius: 999px;
      background: rgba(4, 15, 39, 0.9);
      color: #e5e7eb;
      font-size: 9px;
    }

    .video-timeline {
      height: 4px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      overflow: hidden;
    }

    .video-progress {
      height: 100%;
      width: 35%;
      background: linear-gradient(to right, var(--eu-yellow), #fb923c);
    }

    .video-meta {
      display: flex;
      justify-content: space-between;
      font-size: 9px;
      color: var(--text-soft);
    }

    .storyboard-list {
      margin-top: 4px;
      font-size: 11px;
      padding-left: 16px;
    }

    .storyboard-list li { margin-bottom: 2px; }
    .storyboard-list li.current { color: #e5e7eb; font-weight: 500; }

    .storyboard-controls {
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
    }

    .storyboard-btn {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(4, 15, 39, 0.96);
      color: var(--text-muted);
      cursor: pointer;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: 0.16s all ease-out;
    }

    .storyboard-btn:hover {
      border-color: var(--border-strong);
      transform: translateY(-1px);
    }

    .storyboard-step-indicator {
      font-size: 11px;
      color: var(--text-soft);
    }

    /* MAP WIDGET – WITH REAL MAPS */

    .map-widget {
      margin-top: 4px;
      border-radius: 10px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: radial-gradient(circle at top, #022c22, #050f27);
      padding: 8px;
      display: grid;
      grid-template-columns: 1.4fr 1fr;
      gap: 8px;
    }

    .map-viewport {
      position: relative;
      border-radius: 8px;
      background: #020617;
      overflow: hidden;
      min-height: 280px;
    }

    .map-frame {
      position: absolute;
      inset: 0;
    }

    .map-frame iframe {
      width: 100%;
      height: 100%;
      border: 0;
      border-radius: 8px;
    }

    .map-title-overlay {
      position: absolute;
      top: 6px;
      left: 8px;
      padding: 3px 7px;
      font-size: 10px;
      border-radius: 999px;
      background: rgba(4, 15, 39, 0.92);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #e5e7eb;
      z-index: 2;
    }

    .map-layer-pill {
      position: absolute;
      top: 6px;
      right: 6px;
      display: flex;
      gap: 4px;
      z-index: 2;
    }

    .map-layer-pill span {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 9px;
      background: rgba(4, 15, 39, 0.88);
      color: #cbd5f5;
      cursor: default;
    }

    .map-layer-pill span.active {
      border-color: rgba(56, 189, 248, 0.9);
      background: rgba(0, 68, 148, 0.9);
      color: #e5f0ff;
    }

    .map-corridor {
      position: absolute;
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.9);
      background: rgba(0, 68, 148, 0.92);
      color: #dbeafe;
      font-size: 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: 0.16s all ease-out;
      z-index: 3;
    }

    .map-corridor::before {
      content: "";
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--eu-yellow);
    }

    .map-corridor:hover {
      transform: translateY(-1px) scale(1.02);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.7);
    }

    .map-corridor.active {
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.9);
      background: linear-gradient(to right, var(--eu-blue), var(--eu-blue-dark));
    }

    .map-badge-cluster {
      position: absolute;
      width: 42px;
      height: 42px;
      border-radius: 999px;
      border: 1px solid rgba(15, 23, 42, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #f9fafb;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.5);
      opacity: 0.96;
      z-index: 3;
    }

    .map-badge-cluster--high {
      background: radial-gradient(circle at 30% 20%, #fecaca, #b91c1c);
    }

    .map-badge-cluster--medium {
      background: radial-gradient(circle at 30% 20%, #fed7aa, #c2410c);
    }

    .map-badge-cluster--low {
      background: radial-gradient(circle at 30% 20%, #bbf7d0, #16a34a);
    }

    .map-legend {
      position: absolute;
      right: 6px;
      bottom: 6px;
      padding: 4px 6px;
      border-radius: 6px;
      background: rgba(4, 15, 39, 0.96);
      border: 1px solid rgba(75, 85, 99, 0.9);
      font-size: 9px;
      color: #9ca3af;
      z-index: 2;
    }

    .map-legend-row {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .map-legend-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--eu-yellow);
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.7);
    }

    .map-legend-square {
      width: 8px;
      height: 8px;
      border-radius: 2px;
      background: #22c55e;
    }

    .map-legend-square.high { background: #b91c1c; }
    .map-legend-square.medium { background: #f97316; }

    .map-details {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .map-details strong { color: #e5e7eb; }

    .map-metric-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 5px;
    }

    .map-metric-pill {
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 10px;
      color: #cbd5f5;
      background: rgba(4, 15, 39, 0.8);
    }

    .map-timeline {
      margin-top: 8px;
      font-size: 10px;
      color: var(--text-soft);
    }

    .map-timeline-track {
      margin-top: 4px;
      height: 4px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      position: relative;
      overflow: hidden;
    }

    .map-timeline-fill {
      position: absolute;
      inset: 0;
      width: 55%;
      background: linear-gradient(to right, var(--eu-yellow), #fb923c);
    }

    .map-timeline-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 2px;
    }

    .map-timeline-labels span { font-size: 9px; color: var(--text-soft); }

    /* SOCIAL MOCKUP */

    .social-layout {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 8px;
      margin-top: 4px;
    }

    .social-post-card {
      border-radius: 10px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(4, 15, 39, 0.97);
      padding: 8px;
      font-size: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .social-header {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .social-avatar {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #ffffff, #93c5fd);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      color: #00113b;
    }

    .social-name { font-weight: 600; font-size: 10px; }
    .social-handle { font-size: 9px; color: var(--text-soft); }

    .social-image {
      border-radius: 8px;
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.35), transparent 60%),
        radial-gradient(circle at bottom right, rgba(22, 163, 74, 0.55), #020617);
      height: 90px;
      position: relative;
      overflow: hidden;
    }

    .social-image-label {
      position: absolute;
      left: 6px;
      bottom: 6px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(4, 15, 39, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 9px;
    }

    .social-footer {
      display: flex;
      justify-content: space-between;
      font-size: 9px;
      color: var(--text-soft);
      gap: 4px;
    }

    .social-tiles-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
    }

    .social-tile {
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(4, 15, 39, 0.96);
      padding: 6px;
      font-size: 9px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .tile-title { font-weight: 600; }

    .tile-tag {
      display: inline-block;
      padding: 2px 5px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 8px;
      color: var(--text-soft);
    }

    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: rgba(4, 15, 39, 0.9); }
    ::-webkit-scrollbar-thumb {
      background: rgba(75, 85, 99, 0.8);
      border-radius: 999px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(148, 163, 184, 0.95);
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="header-ribbon"></div>

    <header class="app-header">
      <div class="app-header-main">
        <div class="brand">
          <div class="brand-emblem">
            <div class="brand-emblem-stars">★EU</div>
          </div>
          <div>
            <div class="brand-text-title">Insight Engine Assistant</div>
            <div class="brand-text-subtitle">AI-powered EU space-data storytelling for policy, diplomacy and citizens</div>
          </div>
        </div>

        <div class="badge-strip">
          <div class="badge">
            <div class="badge-dot"></div>
            Prototype · Desktop
          </div>
          <div class="badge badge-pill">
            Copernicus · Galileo · EGNOS · GOVSATCOM · IRIS²
          </div>
          <div class="user-pill">
            <div class="user-avatar">EU</div>
            <div class="user-meta">
              <span>Policy Panel Mode</span>
              <span>Scenario: Delegation communication brief</span>
            </div>
          </div>
        </div>
      </div>

      <div class="app-header-sub">
        <div class="header-sub-left">
          <strong>Mission</strong>
          <span>Turn EU space data into creative, multilingual content accessible to everyone.</span>
        </div>
        <div class="header-sub-badges">
          <span class="header-sub-badge">AI Act-aligned</span>
          <span class="header-sub-badge">GDPR · Data sovereignty</span>
          <span class="header-sub-badge">Green compute (PUE ≤ 1.4)</span>
        </div>
      </div>
    </header>

    <main class="layout-main">
      <!-- LEFT: CONTROLS -->
      <section class="panel">
        <div class="panel-inner">
          <h2>
            Experience setup
            <span>Format · Region · Audience</span>
          </h2>

          <div class="sidebar-section">
            <div class="sidebar-label">Experience type</div>
            <div class="chip-row" id="experienceRow">
              <button class="chip chip-active">Interactive Dashboard</button>
              <button class="chip">Animated Short Film</button>
              <button class="chip">Immersive Map</button>
              <button class="chip">Social Media Pack</button>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-label">Geography / use case</div>
            <div class="chip-row" id="useCaseRow">
              <button class="chip chip-active">Amazon · Deforestation</button>
              <button class="chip">Mozambique · Cyclone response</button>
              <button class="chip">Africa · Clean-energy corridors</button>
              <button class="chip">Global · Daily EU impact</button>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-label">Programme focus</div>
            <div class="chip-row" id="programmeFocusRow">
              <button class="chip chip-active">Copernicus</button>
              <button class="chip">Galileo</button>
              <button class="chip">Mixed (Copernicus + Galileo)</button>
              <button class="chip">Full suite (incl. IRIS²)</button>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-label">Target audience</div>
            <div class="chip-row" id="audienceRow">
              <button class="chip chip-active">EU Delegations</button>
              <button class="chip">Schools / Students</button>
              <button class="chip">Journalists / Media</button>
              <button class="chip">Citizens (general)</button>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-label">Language (example labels)</div>
            <div class="chip-row" id="languageRow">
              <button class="chip chip-active">EN</button>
              <button class="chip">FR</button>
              <button class="chip">PT</button>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-label">Governance</div>
            <div class="status-pill">
              <svg viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="rgba(34,197,94,0.5)" stroke-width="1.5" />
                <path d="M8 12.5L10.5 15L16 9" stroke="#22c55e" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              Compliant · AI Act &amp; GDPR
            </div>
            <div class="sidebar-note">
              Federated data handling, human review for narratives, hosted in EU data centres with monitored energy footprint.
            </div>
          </div>
        </div>
      </section>

      <!-- CENTER: CHAT ONLY -->
      <section class="panel chat-panel">
        <div class="panel-inner">
          <div class="chat-header">
            <div class="chat-header-title">Conversational workspace</div>
            <div class="chat-header-sub">
              Describe what you need. The assistant uses EU space data and your setup (left) to define the experience. The visual result appears on the right.
            </div>
          </div>

          <div class="chat-body" id="chatBody"></div>

          <div class="chat-input-area">
            <div class="chat-input-row">
              <textarea
                id="chatInput"
                class="chat-input"
                rows="2"
                placeholder="Example: “Design a Copernicus dashboard on real-time deforestation alerts in the Amazon for Delegations and journalists.”"
              ></textarea>
              <button class="btn-send" id="sendBtn">
                <span>Generate</span>
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M4 19L20 12L4 5L4 11L14 12L4 13L4 19Z" fill="currentColor" />
                </svg>
              </button>
            </div>
            <div class="chat-footnote">
              <span>ⓘ <span>AI-assisted · Human review required before external dissemination.</span></span>
              <span>Mode: <strong>Prototype · Internal</strong></span>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT: STORY CANVAS -->
      <section class="panel canvas-panel">
        <div class="panel-inner">
          <div class="canvas-header">
            <div>
              <div class="canvas-title">Story canvas</div>
              <div class="canvas-sub">
                Concrete example of the output configured on the left – dashboard, short film, immersive map or social pack.
              </div>
            </div>
            <div class="pill-ai-label">
              <svg viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="9" stroke="rgba(148,163,184,0.7)" stroke-width="1.4" />
                <path d="M9.5 10.2C9.5 8.9 10.4 8 11.8 8C13.1 8 14 8.8 14 9.9C14 10.8 13.5 11.4 12.7 11.8L12.5 11.9C11.9 12.2 11.7 12.5 11.7 13.1V13.4" stroke="#e5e7eb" stroke-width="1.4" stroke-linecap="round" />
                <circle cx="11.8" cy="15.3" r="0.9" fill="#e5e7eb" />
              </svg>
              AI-generated · Human-reviewed
            </div>
          </div>

          <div class="canvas-body">
            <div class="canvas-meta-row">
              <span>
                Scenario:
                <span id="canvasScenarioSummary">Dashboard · Amazon · Copernicus · EU Delegations</span>
              </span>
              <div class="canvas-meta-badges">
                <div class="meta-badge">AI Act · risk-based</div>
                <div class="meta-badge">Transparency label</div>
                <div class="meta-badge">Official EU space data</div>
              </div>
            </div>

            <div class="canvas-scroll" id="canvasContent"></div>

            <div class="hint-bar">
              <span>Change the experience type, region or audience on the left – this preview updates automatically.</span>
              <span>Designed for web, briefings and Delegation sites.</span>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const basePolicyIdeas =
      "Insight Engine is a joint EUSPA–EEAS AI storytelling platform that turns Copernicus, Galileo, EGNOS, GOVSATCOM and IRIS² data into multilingual narratives, visuals and communication products. " +
      "It is aligned with the AI Act, GDPR and data-sovereignty requirements, and uses green computing. " +
      "The objective is to strengthen EU foreign policy, strategic communication and downstream industry by making space-data visible, human-centred and democratic.";

    const chatBody = document.getElementById("chatBody");
    const chatInput = document.getElementById("chatInput");
    const sendBtn = document.getElementById("sendBtn");
    const canvasContent = document.getElementById("canvasContent");
    const canvasScenarioSummary = document.getElementById("canvasScenarioSummary");

    let activeTab = "dashboard";

    function appendMessage(author, text) {
      const group = document.createElement("div");
      group.className = "message-group";
      const meta = document.createElement("div");
      meta.className = "message-meta";
      const who = document.createElement("span");
      who.textContent = author === "user" ? "You" : "Insight Engine";
      const mode = document.createElement("span");
      mode.textContent = author === "user" ? "Prompt" : "Prototype response";
      meta.appendChild(who);
      meta.appendChild(mode);
      const bubble = document.createElement("div");
      bubble.className = "message-bubble" + (author === "assistant" ? " assistant" : "");
      bubble.innerHTML = text;
      group.appendChild(meta);
      group.appendChild(bubble);
      chatBody.appendChild(group);
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    function initialMessages() {
      appendMessage(
        "assistant",
        "<strong>Welcome.</strong> Use the controls on the left to choose a format (dashboard, film, map, social pack), region and audience. " +
        "Then describe your needs in natural language – the Story Canvas on the right shows a concrete example of the configured output."
      );
      appendMessage(
        "user",
        "Show how the Insight Engine could present Copernicus deforestation alerts in the Amazon for EU Delegations."
      );
      appendMessage(
        "assistant",
        "Understood. With the current setup, the canvas displays an interactive Copernicus dashboard for Amazon deforestation alerts. " +
        "Switch to Mozambique, Africa or Global, or change the experience type, to see diverse outputs: a Galileo film, an immersive corridor map, or a global daily social pack."
      );
    }
    initialMessages();

    function getActiveChipLabel(id) {
      const row = document.getElementById(id);
      if (!row) return null;
      const active = row.querySelector(".chip-active");
      return active ? active.textContent.trim() : null;
    }

    function generateAssistantResponse(userText) {
      const experience = getActiveChipLabel("experienceRow") || "Interactive Dashboard";
      const useCase = getActiveChipLabel("useCaseRow") || "Global · Daily EU impact";
      const programme = getActiveChipLabel("programmeFocusRow") || "Copernicus";
      const audience = getActiveChipLabel("audienceRow") || "EU Delegations";
      return (
        "<strong>Configured experience:</strong> " +
        experience + " · " + useCase + " · " + programme + " · " + audience +
        "<br/><br/>" +
        "The Story Canvas on the right now shows a visual example tailored to this scenario. " +
        "In an operational system, it would be populated with live EU space data and export-ready formats for Delegations, schools, journalists and citizens.<br/><br/>" +
        "<strong>Policy backbone:</strong> " + basePolicyIdeas
      );
    }

    function handleSend() {
      const text = chatInput.value;
      if (!text.trim()) return;
      appendMessage("user", text);
      const response = generateAssistantResponse(text);
      appendMessage("assistant", response);
      chatInput.value = "";
      updateCanvas();
    }

    sendBtn.addEventListener("click", handleSend);
    chatInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    });

    function setupChipRow(id, onClickExtra) {
      const row = document.getElementById(id);
      if (!row) return;
      row.addEventListener("click", (e) => {
        if (e.target.classList.contains("chip")) {
          [...row.querySelectorAll(".chip")].forEach((chip) => chip.classList.remove("chip-active"));
          e.target.classList.add("chip-active");
          if (onClickExtra) onClickExtra(e.target.textContent.trim());
          updateCanvas();
        }
      });
    }

    setupChipRow("experienceRow", (label) => {
      if (label.startsWith("Interactive Dashboard")) activeTab = "dashboard";
      else if (label.startsWith("Animated Short Film")) activeTab = "animation";
      else if (label.startsWith("Immersive Map")) activeTab = "map";
      else if (label.startsWith("Social Media Pack")) activeTab = "social";
    });
    setupChipRow("useCaseRow");
    setupChipRow("programmeFocusRow");
    setupChipRow("audienceRow");
    setupChipRow("languageRow");

    function getLabelForLanguage(key, lang) {
      const dict = {
        todayFromSpace: {
          EN: "Today from space",
          FR: "Aujourd’hui depuis l’espace",
          PT: "Hoje desde o espaço",
        },
        learnMore: {
          EN: "Learn more",
          FR: "En savoir plus",
          PT: "Saiba mais",
        },
        poweredByEU: {
          EN: "Powered by EU space data",
          FR: "Propulsé par les données spatiales de l’UE",
          PT: "Impulsionado por dados espaciais da UE",
        },
      };
      return (dict[key] && dict[key][lang]) || dict[key]["EN"];
    }

    function classifyUseCase(useCase) {
      if (!useCase) return "Global";
      if (useCase.includes("Amazon")) return "Amazon";
      if (useCase.includes("Mozambique")) return "Mozambique";
      if (useCase.includes("Africa")) return "Africa";
      return "Global";
    }

    function updateScenarioSummary() {
      const exp = getActiveChipLabel("experienceRow") || "Dashboard";
      const useCase = getActiveChipLabel("useCaseRow") || "Global";
      const prog = getActiveChipLabel("programmeFocusRow") || "Copernicus";
      const audience = getActiveChipLabel("audienceRow") || "EU Delegations";
      canvasScenarioSummary.textContent = exp + " · " + useCase + " · " + prog + " · " + audience;
    }

    function renderDashboardTab(useCase, programme, audience, language) {
      const type = classifyUseCase(useCase);
      const card = document.createElement("div");
      card.className = "canvas-card";

      let titleSuffix, subtitle, kpi1Label, kpi1Value, kpi1Trend, kpi2Label, kpi2Value, kpi2Trend, mapTitle;
      const todayLabel = getLabelForLanguage("todayFromSpace", language);

      if (type === "Amazon") {
        titleSuffix = " · Amazon deforestation alerts";
        subtitle = "Real-time forest-change alerts in the Amazon basin for EU Delegations.";
        kpi1Label = "Active deforestation alerts"; kpi1Value = "128"; kpi1Trend = "+12 vs. yesterday";
        kpi2Label = "Forest at risk"; kpi2Value = "3 240 km²"; kpi2Trend = "−5% vs. last week";
        mapTitle = "Alert density map";
      } else if (type === "Mozambique") {
        titleSuffix = " · Cyclone impact & convoy routing";
        subtitle = "Storm track, flooded areas and safe road segments for humanitarian convoys.";
        kpi1Label = "Communities affected"; kpi1Value = "740k"; kpi1Trend = "+30k vs. initial estimate";
        kpi2Label = "Accessible routes"; kpi2Value = "82%"; kpi2Trend = "↑ after clearance";
        mapTitle = "Impact & access map";
      } else if (type === "Africa") {
        titleSuffix = " · Clean-energy corridor overview";
        subtitle = "Sites and corridors identified for solar, wind and grid upgrades.";
        kpi1Label = "Priority projects"; kpi1Value = "36"; kpi1Trend = "+4 this quarter";
        kpi2Label = "Estimated CO₂ savings"; kpi2Value = "5.3 Mt/yr"; kpi2Trend = "↑ pipeline expanding";
        mapTitle = "Corridor suitability map";
      } else {
        titleSuffix = " · Daily EU environmental indicators";
        subtitle = "High-level overview of climate and environment indicators worldwide.";
        kpi1Label = "Monitored regions"; kpi1Value = "112"; kpi1Trend = "+6 regions onboarded";
        kpi2Label = "New alerts today"; kpi2Value = "54"; kpi2Trend = "stable vs. last week";
        mapTitle = "Global hotspots";
      }

      card.innerHTML =
        '<div class="canvas-card-header">' +
        '<div>' +
        '<div class="canvas-card-title">Interactive dashboard' + titleSuffix + "</div>" +
        '<div class="canvas-card-sub">' + subtitle + "</div>" +
        "</div>" +
        '<span class="canvas-card-sub">' + programme + "</span>" +
        "</div>";

      const dash = document.createElement("div");
      dash.className = "dash-card";
      dash.innerHTML =
        '<div class="dash-header">' +
        '<div class="dash-header-left">' +
        '<div class="dash-title">' + todayLabel + "</div>" +
        '<div class="dash-subtitle">' + subtitle + "</div>" +
        "</div>" +
        '<div class="dash-header-right">' +
        '<div class="dash-filter">Time: 24h ▾</div>' +
        '<div class="dash-filter">Audience: ' + audience + "</div>" +
        "</div>" +
        "</div>" +
        '<div class="dash-body">' +
        '<div class="dash-map-mini">' +
        '<div class="dash-map-header"><span>' + mapTitle + "</span>" +
        "<span style='font-size:8px;'>High ▪ Medium ▪ Low</span></div>" +
        '<div class="dash-map-grid" id="dashMapGrid"></div>' +
        "</div>" +
        '<div class="dash-kpis">' +
        '<div class="kpi">' +
        '<div class="kpi-label">' + kpi1Label + "</div>" +
        '<div class="kpi-value">' + kpi1Value + "</div>" +
        '<div class="kpi-trend">' + kpi1Trend + "</div>" +
        "</div>" +
        '<div class="kpi">' +
        '<div class="kpi-label">' + kpi2Label + "</div>" +
        '<div class="kpi-value">' + kpi2Value + "</div>" +
        '<div class="kpi-trend' + (kpi2Trend.startsWith("−") ? " down" : "") + "'>" + kpi2Trend + "</div>" +
        "</div>" +
        "</div>" +
        "</div>" +
        '<div class="dash-chart">' +
        "<div>Trend over last 7 days</div>" +
        '<div class="chart-bars">' +
        '<div class="chart-bar" style="height:35%;"></div>' +
        '<div class="chart-bar" style="height:60%;"></div>' +
        '<div class="chart-bar" style="height:45%;"></div>' +
        '<div class="chart-bar low" style="height:30%;"></div>' +
        '<div class="chart-bar" style="height:70%;"></div>' +
        '<div class="chart-bar" style="height:55%;"></div>' +
        "</div>" +
        '<div class="chart-x-labels">' +
        "<span>Day 1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span>" +
        "</div>" +
        "</div>" +
        '<div class="dash-footer">' +
        "<span>Data: " + programme + " (prototype). Filters and captions localised in " + language + ".</span>" +
        '<button class="dash-export">Export snapshot</button>' +
        "</div>";

      card.appendChild(dash);

      const tags = document.createElement("div");
      tags.className = "canvas-tag-row";
      [ "Dashboard", programme, useCase, audience ].forEach((label, idx) => {
        const t = document.createElement("span");
        t.className = "tag" + (idx < 2 ? " tag-accent" : "");
        t.textContent = label;
        tags.appendChild(t);
      });
      card.appendChild(tags);
      canvasContent.appendChild(card);

      const grid = card.querySelector("#dashMapGrid");
      if (grid) {
        const pattern = type === "Amazon"
          ? ["high","medium","low","medium","high","low"]
          : type === "Mozambique"
          ? ["medium","high","high","medium","low","medium"]
          : type === "Africa"
          ? ["low","medium","low","high","medium","low"]
          : ["low","low","medium","medium","high","low"];
        for (let i = 0; i < 24; i++) {
          const cell = document.createElement("div");
          cell.className = "dash-cell " + pattern[i % pattern.length];
          grid.appendChild(cell);
        }
      }
    }

    function renderAnimationTab(useCase, programme, audience, language) {
      const type = classifyUseCase(useCase);
      const card = document.createElement("div");
      card.className = "canvas-card";
      const learnMoreLabel = getLabelForLanguage("learnMore", language);

      let title, subtitle, overlay, scenes;
      if (type === "Mozambique") {
        title = "Animated short film · Humanitarian convoys after cyclone";
        subtitle = "60–90s narrative on how satellites guide relief to communities in Mozambique.";
        overlay = "Cyclone response · " + programme;
        scenes = [
          "Opening: satellite view of cyclone landfall over Mozambique.",
          "Impact: flooded areas and damaged roads highlighted in colour.",
          "Convoys: safe routes and staging hubs appear along the map.",
          "EU support: EU and partner logos; space and civil protection cooperation.",
          "Closing: “" + learnMoreLabel + "” + link to an EU crisis-response page."
        ];
      } else if (type === "Amazon") {
        title = "Animated short film · Forests seen from space";
        subtitle = "Short film for citizens and schools on Amazon deforestation monitoring.";
        overlay = "Forest watch · " + programme;
        scenes = [
          "Opening: canopy view fades into satellite imagery.",
          "Alerts: red tiles appear where forest loss is detected.",
          "On the ground: rangers and communities use printed maps and apps.",
          "EU story: support to monitoring and sustainable value chains.",
          "Closing: “" + learnMoreLabel + "” + link to EU environmental programmes."
        ];
      } else if (type === "Africa") {
        title = "Animated short film · Clean-energy corridors";
        subtitle = "Explainer on how space data supports solar and grid planning in Africa.";
        overlay = "Energy corridors · " + programme;
        scenes = [
          "Opening: lights of the continent at night, highlighting gaps.",
          "Data layers: solar, wind and grid layers appear over the map.",
          "Projects: key corridors and substations are highlighted.",
          "Partnership: EU, African Union and partners appear as co-creators.",
          "Closing: “" + learnMoreLabel + "” + link to an EU–Africa investment platform."
        ];
      } else {
        title = "Animated short film · EU space for a safer planet";
        subtitle = "Global overview for social media and events.";
        overlay = "Global impact · EU space";
        scenes = [
          "Opening: Earth from orbit with EU satellites.",
          "Scenes: quick cuts for forest, oceans, cities and crises.",
          "Data to decisions: dashboards in Delegations and ministries.",
          "Citizens: classrooms, journalists and start-ups using the insights.",
          "Closing: “" + learnMoreLabel + "” + link to a central EU portal."
        ];
      }

      card.innerHTML =
        '<div class="canvas-card-header">' +
        '<div>' +
        '<div class="canvas-card-title">' + title + "</div>" +
        '<div class="canvas-card-sub">' + subtitle + "</div>" +
        "</div>" +
        '<span class="canvas-card-sub">' + programme + "</span>" +
        "</div>";

      const layout = document.createElement("div");
      layout.className = "video-layout";

      const player = document.createElement("div");
      player.className = "video-player";
      player.innerHTML =
        '<div class="video-frame">' +
        '<div class="video-play-btn" title="Play"></div>' +
        '<div class="video-caption-overlay">' + overlay + "</div>" +
        "</div>" +
        '<div class="video-timeline"><div class="video-progress"></div></div>' +
        '<div class="video-meta"><span>0:12 / 1:05</span><span>Subtitles: ' + language + "</span></div>" +
        "<div>Caption example: “Satellites provide the overview; EU partners turn it into action on the ground.”</div>";

      const storyboard = document.createElement("div");
      let listHTML = "<div style='font-size:11px;font-weight:600;margin-bottom:3px;'>Storyboard scenes</div><ul class='storyboard-list'>";
      scenes.forEach((s, i) => {
        listHTML += "<li data-step='" + (i + 1) + "'>" + s + "</li>";
      });
      listHTML += "</ul>" +
        '<div class="storyboard-controls">' +
        '<button class="storyboard-btn">▶ Next scene</button>' +
        '<span class="storyboard-step-indicator">Current scene: 1 / ' + scenes.length + "</span>" +
        "</div>";
      storyboard.innerHTML = listHTML;

      layout.appendChild(player);
      layout.appendChild(storyboard);
      card.appendChild(layout);

      const tags = document.createElement("div");
      tags.className = "canvas-tag-row";
      ["Animated film", programme, useCase, audience].forEach((label, idx) => {
        const t = document.createElement("span");
        t.className = "tag" + (idx < 2 ? " tag-accent" : "");
        t.textContent = label;
        tags.appendChild(t);
      });
      card.appendChild(tags);
      canvasContent.appendChild(card);

      const list = card.querySelector(".storyboard-list");
      const btn = card.querySelector(".storyboard-btn");
      const indicator = card.querySelector(".storyboard-step-indicator");
      let currentStep = 1;

      function updateStoryboardHighlight() {
        [...list.querySelectorAll("li")].forEach((li) => {
          const step = Number(li.dataset.step);
          li.classList.toggle("current", step === currentStep);
        });
        indicator.textContent = "Current scene: " + currentStep + " / " + scenes.length;
      }
      updateStoryboardHighlight();

      btn.addEventListener("click", () => {
        currentStep = currentStep === scenes.length ? 1 : currentStep + 1;
        updateStoryboardHighlight();
      });
    }

    function getMapIframeSrc(type) {
      // Simple OpenStreetMap embed URLs with approximate bounding boxes
      if (type === "Amazon") {
        // Northern Brazil / Amazon basin
        return "https://www.openstreetmap.org/export/embed.html?bbox=-74.0%2C-12.0%2C-44.0%2C6.0&layer=mapnik";
      }
      if (type === "Mozambique") {
        return "https://www.openstreetmap.org/export/embed.html?bbox=30.0%2C-25.5%2C42.0%2C-10.0&layer=mapnik";
      }
      if (type === "Africa") {
        return "https://www.openstreetmap.org/export/embed.html?bbox=-20.0%2C-36.0%2C55.0%2C38.0&layer=mapnik";
      }
      // Global-ish
      return "https://www.openstreetmap.org/export/embed.html?bbox=-180.0%2C-60.0%2C180.0%2C80.0&layer=mapnik";
    }

    function renderMapTab(useCase, programme, audience, language) {
      const type = classifyUseCase(useCase);
      const card = document.createElement("div");
      card.className = "canvas-card";

      let title, subtitle, titleOverlay, layerLabels, corridorsData;
      if (type === "Africa") {
        title = "Immersive map · Africa clean-energy corridors";
        subtitle = "Explorable corridors and projects for Delegations and partner briefings.";
        titleOverlay = "Africa · Clean-energy corridors";
        layerLabels = ["Solar", "Grid", "Projects"];
        corridorsData = {
          sahel: {
            label: "Sahel corridor",
            text: "Cross-border solar and transmission projects identified through solar resource and land-use layers.",
            metrics: ["≈ 2.5M people reached", "≈ 1.2 MtCO₂ avoided / year", "EU support: grants + blending"],
            pos: {top: "38%", left: "30%"},
            cluster: {top: "30%", left: "34%", type: "high", value: "H"}
          },
          east: {
            label: "East Africa grid",
            text: "Interconnectors mapped with satellite-derived demand, terrain and climate risk.",
            metrics: ["≈ 3.1M people reached", "≈ 1.8 MtCO₂ avoided / year", "EU support: technical assistance"],
            pos: {top: "55%", left: "55%"},
            cluster: {top: "50%", left: "58%", type: "medium", value: "M"}
          },
          south: {
            label: "Southern solar belt",
            text: "Utility-scale solar sites screened for suitability and environmental constraints.",
            metrics: ["≈ 4.0M people reached", "≈ 2.3 MtCO₂ avoided / year", "EU support: guarantees + investment"],
            pos: {top: "70%", left: "44%"},
            cluster: {top: "68%", left: "48%", type: "low", value: "L"}
          }
        };
      } else if (type === "Mozambique") {
        title = "Immersive map · Cyclone impact and access in Mozambique";
        subtitle = "Impact footprint and access constraints after a major cyclone, for crisis coordination.";
        titleOverlay = "Mozambique · Cyclone response";
        layerLabels = ["Flood", "Access", "Shelters"];
        corridorsData = {
          impact: {
            label: "Impact zone",
            text: "Flooded districts with population estimates and critical infrastructure.",
            metrics: ["≈ 740k people affected", "Critical bridges: 7", "Shelters mapped: 52"],
            pos: {top: "40%", left: "50%"},
            cluster: {top: "36%", left: "53%", type: "high", value: "H"}
          },
          convoys: {
            label: "Convoy routes",
            text: "Safe road segments and backup routes based on flood and landslide data.",
            metrics: ["Main corridors: 5", "Access restored: 82%", "Data refresh: 3h"],
            pos: {top: "60%", left: "40%"},
            cluster: {top: "58%", left: "43%", type: "medium", value: "M"}
          },
          hubs: {
            label: "Logistics hubs",
            text: "Airstrips and warehouses used to pre-position relief supplies.",
            metrics: ["Strategic hubs: 9", "Reachable districts: 32", "Partners: EU, UN, local"],
            pos: {top: "55%", left: "25%"},
            cluster: {top: "52%", left: "29%", type: "low", value: "L"}
          }
        };
      } else if (type === "Amazon") {
        title = "Immersive map · Amazon forest watch";
        subtitle = "Interactive view of forest alerts, protected areas and EU-supported initiatives.";
        titleOverlay = "Amazon · Forest alerts";
        layerLabels = ["Forest loss", "Protected areas", "Projects"];
        corridorsData = {
          hot: {
            label: "Alert hotspots",
            text: "Clusters of recent deforestation alerts along key fronts.",
            metrics: ["Active hotspots: 12", "Average alert age: 14h", "Priority follow-up: high"],
            pos: {top: "42%", left: "35%"},
            cluster: {top: "38%", left: "39%", type: "high", value: "H"}
          },
          protected: {
            label: "Protected areas",
            text: "Overlap of alerts with indigenous and protected territories.",
            metrics: ["Protected areas affected: 4", "Alerts in buffer zones: 22", "Legal follow-up: required"],
            pos: {top: "55%", left: "55%"},
            cluster: {top: "51%", left: "58%", type: "medium", value: "M"}
          },
          projects: {
            label: "EU-supported projects",
            text: "Monitoring and sustainable value chain projects using this data.",
            metrics: ["Projects mapped: 11", "Partner organisations: 18", "Downloadable project sheets"],
            pos: {top: "68%", left: "45%"},
            cluster: {top: "66%", left: "49%", type: "low", value: "L"}
          }
        };
      } else {
        title = "Immersive map · Global daily EU impact";
        subtitle = "Map of selected environmental and security contributions from EU space data.";
        titleOverlay = "Global · Daily impact";
        layerLabels = ["Climate", "Crises", "Connectivity"];
        corridorsData = {
          climate: {
            label: "Climate & environment",
            text: "Examples of climate monitoring products used in national policies.",
            metrics: ["Countries featured: 14", "New stories today: 3", "Sectors: forests, coasts, cities"],
            pos: {top: "40%", left: "35%"},
            cluster: {top: "35%", left: "39%", type: "medium", value: "M"}
          },
          crises: {
            label: "Crisis response",
            text: "Rapid mapping for natural disasters and humanitarian crises.",
            metrics: ["Ongoing activations: 5", "Completed this month: 18", "Regional coverage: global"],
            pos: {top: "50%", left: "55%"},
            cluster: {top: "47%", left: "59%", type: "high", value: "H"}
          },
          connectivity: {
            label: "Connectivity & security",
            text: "Secure communication and navigation services supporting operations.",
            metrics: ["Satcom-supported ops: 9", "Navigation-focused: 7", "Partners: EU agencies + Member States"],
            pos: {top: "62%", left: "45%"},
            cluster: {top: "60%", left: "49%", type: "low", value: "L"}
          }
        };
      }

      card.innerHTML =
        '<div class="canvas-card-header">' +
        '<div>' +
        '<div class="canvas-card-title">' + title + "</div>" +
        '<div class="canvas-card-sub">' + subtitle + "</div>" +
        "</div>" +
        '<span class="canvas-card-sub">' + programme + "</span>" +
        "</div>";

      const mapWidget = document.createElement("div");
      mapWidget.className = "map-widget";

      const viewport = document.createElement("div");
      viewport.className = "map-viewport";

      const frame = document.createElement("div");
      frame.className = "map-frame";
      const iframe = document.createElement("iframe");
      iframe.src = getMapIframeSrc(type);
      iframe.loading = "lazy";
      frame.appendChild(iframe);
      viewport.appendChild(frame);

      const titleOverlayEl = document.createElement("div");
      titleOverlayEl.className = "map-title-overlay";
      titleOverlayEl.textContent = titleOverlay;
      viewport.appendChild(titleOverlayEl);

      const layerPills = document.createElement("div");
      layerPills.className = "map-layer-pill";
      layerLabels.forEach((label, i) => {
        const span = document.createElement("span");
        span.textContent = label;
        if (i === 0) span.classList.add("active");
        layerPills.appendChild(span);
      });
      viewport.appendChild(layerPills);

      const legend = document.createElement("div");
      legend.className = "map-legend";
      legend.innerHTML =
        '<div class="map-legend-row"><span class="map-legend-dot"></span> Corridor / focus zone</div>' +
        '<div class="map-legend-row" style="margin-top:2px;">' +
        '<span class="map-legend-square high"></span> High intensity&nbsp;&nbsp;' +
        '<span class="map-legend-square medium"></span> Medium&nbsp;&nbsp;' +
        '<span class="map-legend-square"></span> Low' +
        "</div>";
      viewport.appendChild(legend);

      const details = document.createElement("div");
      details.className = "map-details";

      Object.keys(corridorsData).forEach((id) => {
        const c = corridorsData[id];

        const corridorEl = document.createElement("div");
        corridorEl.className = "map-corridor";
        corridorEl.setAttribute("data-id", id);
        corridorEl.style.top = c.pos.top;
        corridorEl.style.left = c.pos.left;
        corridorEl.textContent = c.label;
        viewport.appendChild(corridorEl);

        if (c.cluster) {
          const cluster = document.createElement("div");
          cluster.className = "map-badge-cluster map-badge-cluster--" + c.cluster.type;
          cluster.style.top = c.cluster.top;
          cluster.style.left = c.cluster.left;
          cluster.textContent = c.cluster.value;
          viewport.appendChild(cluster);
        }
      });

      mapWidget.appendChild(viewport);
      mapWidget.appendChild(details);

      const timeline = document.createElement("div");
      timeline.className = "map-timeline";
      timeline.innerHTML =
        "<div>Time filter (prototype)</div>" +
        '<div class="map-timeline-track"><div class="map-timeline-fill"></div></div>' +
        '<div class="map-timeline-labels"><span>Last 7 days</span><span>Last 24 hours</span></div>';
      mapWidget.appendChild(timeline);

      card.appendChild(mapWidget);

      const tags = document.createElement("div");
      tags.className = "canvas-tag-row";
      ["Immersive map", programme, useCase, audience].forEach((label, idx) => {
        const t = document.createElement("span");
        t.className = "tag" + (idx < 2 ? " tag-accent" : "");
        t.textContent = label;
        tags.appendChild(t);
      });
      card.appendChild(tags);
      canvasContent.appendChild(card);

      const corridors = card.querySelectorAll(".map-corridor");

      function setActiveCorridor(id) {
        corridors.forEach((c) => c.classList.toggle("active", c.getAttribute("data-id") === id));
        const data = corridorsData[id];
        if (!data) return;
        let html = "<strong>" + data.label + ":</strong> " + data.text + '<div class="map-metric-row">';
        data.metrics.forEach((m) => {
          html += '<div class="map-metric-pill">' + m + "</div>";
        });
        html += "</div>";
        details.innerHTML = html;
      }

      corridors.forEach((c) => {
        c.addEventListener("click", () => setActiveCorridor(c.getAttribute("data-id")));
      });

      setActiveCorridor(Object.keys(corridorsData)[0]);
    }

    function renderSocialTab(useCase, programme, audience, language) {
      const type = classifyUseCase(useCase);
      const card = document.createElement("div");
      card.className = "canvas-card";

      const todayLabel = getLabelForLanguage("todayFromSpace", language);
      const poweredLabel = getLabelForLanguage("poweredByEU", language);

      let postText, imageLabel, tile1, tile2, tile3, tile4;
      if (type === "Amazon") {
        postText = todayLabel + ": satellite data show a rise in deforestation alerts in the Amazon. EU-supported projects help protect forests and communities.";
        imageLabel = "Amazon alerts · " + programme;
        tile1 = { title: "How EU space sees the forest", body: "Copernicus monitors forest cover and flags sudden changes for authorities.", tag: "Explainer" };
        tile2 = { title: "Why this matters locally", body: "Deforestation affects rainfall, soil and livelihoods. Local partners use this data for action.", tag: "Impact" };
        tile3 = { title: "EU in your region", body: "Delegations can add local examples and links to EU-supported projects.", tag: "Delegation" };
        tile4 = { title: "For classrooms", body: "Teachers can switch to a simplified classroom story with activities.", tag: "Education" };
      } else if (type === "Mozambique") {
        postText = todayLabel + ": satellite images help track flooding in Mozambique and guide humanitarian convoys to isolated communities.";
        imageLabel = "Cyclone impact · " + programme;
        tile1 = { title: "From orbit to road", body: "Satellites show where roads are passable so convoys can move safely.", tag: "Crisis" };
        tile2 = { title: "Working with local teams", body: "EU missions share these maps with national services and NGOs.", tag: "Partnership" };
        tile3 = { title: "Rapid updates", body: "Maps are refreshed every few hours, keeping responders informed.", tag: "Timeliness" };
        tile4 = { title: "Human stories", body: "Posts can include short testimonies from affected communities.", tag: "Story" };
      } else if (type === "Africa") {
        postText = todayLabel + ": EU space data supports new clean-energy corridors across Africa, from solar parks to stronger grids.";
        imageLabel = "Energy corridors · " + programme;
        tile1 = { title: "Mapping the sun", body: "Solar potential maps show where projects can have the highest impact.", tag: "Solar" };
        tile2 = { title: "Connecting people", body: "Corridors bring reliable power to homes, schools and clinics.", tag: "Access" };
        tile3 = { title: "Joint investment", body: "EU and African partners co-design and co-finance key projects.", tag: "Investment" };
        tile4 = { title: "Climate benefits", body: "Projects reduce emissions and support resilience to heat and drought.", tag: "Climate" };
      } else {
        postText = todayLabel + ": from flood alerts to air-quality maps, EU space data supports decisions worldwide every day.";
        imageLabel = "Daily impact · EU space";
        tile1 = { title: "Data in your city", body: "Local governments use EU space data for planning and resilience.", tag: "City" };
        tile2 = { title: "For journalists", body: "Visuals and data can be downloaded with clear source labels.", tag: "Media" };
        tile3 = { title: "For schools", body: "Teachers can turn complex datasets into simple classroom stories.", tag: "Education" };
        tile4 = { title: "For start-ups", body: "Entrepreneurs can build services on top of open EU data.", tag: "Innovation" };
      }

      card.innerHTML =
        '<div class="canvas-card-header">' +
        '<div>' +
        '<div class="canvas-card-title">Social-media pack · ' + type + ' focus</div>' +
        '<div class="canvas-card-sub">Ready-to-use posts and tiles for Delegations, media and schools.</div>' +
        "</div>" +
        '<span class="canvas-card-sub">' + programme + "</span>" +
        "</div>";

      const layout = document.createElement("div");
      layout.className = "social-layout";

      const post = document.createElement("div");
      post.className = "social-post-card";
      post.innerHTML =
        '<div class="social-header">' +
        '<div class="social-avatar">EU</div>' +
        '<div>' +
        '<div class="social-name">EU Space – Insight Engine</div>' +
        '<div class="social-handle">@EU_Space • 6 min</div>' +
        "</div>" +
        "</div>" +
        "<div>" + postText + "</div>" +
        '<div class="social-image">' +
        '<div class="social-image-label">' + poweredLabel + "</div>" +
        "</div>" +
        '<div class="social-footer">' +
        "<span>" + imageLabel + "</span>" +
        "<span>♡ 124 · ⤴ 32</span>" +
        "</div>";

      const tiles = document.createElement("div");
      tiles.className = "social-tiles-grid";
      [tile1, tile2, tile3, tile4].forEach((tile) => {
        const t = document.createElement("div");
        t.className = "social-tile";
        t.innerHTML =
          '<div class="tile-title">' + tile.title + "</div>" +
          "<div>" + tile.body + "</div>" +
          '<span class="tile-tag">' + tile.tag + "</span>";
        tiles.appendChild(t);
      });

      layout.appendChild(post);
      layout.appendChild(tiles);
      card.appendChild(layout);

      const tags = document.createElement("div");
      tags.className = "canvas-tag-row";
      ["Social pack", type + " focus", programme, audience].forEach((label, idx) => {
        const t = document.createElement("span");
        t.className = "tag" + (idx < 2 ? " tag-accent" : "");
        t.textContent = label;
        tags.appendChild(t);
      });
      card.appendChild(tags);
      canvasContent.appendChild(card);
    }

    function updateCanvas() {
      const useCase = getActiveChipLabel("useCaseRow") || "Global · Daily EU impact";
      const programme = getActiveChipLabel("programmeFocusRow") || "Copernicus";
      const audience = getActiveChipLabel("audienceRow") || "EU Delegations";
      const language = getActiveChipLabel("languageRow") || "EN";

      updateScenarioSummary();
      canvasContent.innerHTML = "";

      if (activeTab === "dashboard") {
        renderDashboardTab(useCase, programme, audience, language);
      } else if (activeTab === "animation") {
        renderAnimationTab(useCase, programme, audience, language);
      } else if (activeTab === "map") {
        renderMapTab(useCase, programme, audience, language);
      } else if (activeTab === "social") {
        renderSocialTab(useCase, programme, audience, language);
      }
    }

    updateCanvas();
  </script>
</body>
</html>
