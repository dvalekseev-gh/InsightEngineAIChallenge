<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Insight Engine – EU Space Data Assistant (Desktop Prototype)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /*****************************************************
     * GLOBAL THEME – DARK EU OFFICIAL LOOK
     *****************************************************/
    :root {
      --eu-blue: #004494;
      --eu-blue-dark: #002766;
      --eu-blue-deep: #020617;
      --eu-blue-soft: #0b1730;
      --eu-yellow: #ffd617;

      --bg-gradient: radial-gradient(circle at top, #041331 0%, #020617 55%, #000 100%);
      --panel-bg: #050f27;
      --panel-bg-alt: #07162f;

      --text-main: #f9fafb;
      --text-muted: #d1ddff;
      --text-soft: #9ca3af;

      --border-subtle: rgba(148, 163, 184, 0.35);
      --border-strong: rgba(148, 163, 184, 0.75);
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.7);

      --accent: var(--eu-blue);
      --accent-soft: rgba(0, 68, 148, 0.17);
      --accent-soft-strong: rgba(0, 68, 148, 0.28);

      --success: #22c55e;

      --radius-lg: 18px;
      --radius-xl: 22px;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-gradient);
      color: var(--text-main);
      height: 100%;
      overscroll-behavior: none;
    }

    body {
      overflow: hidden;
    }

    .app-shell {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /*****************************************************
     * HEADER
     *****************************************************/
    .header-ribbon {
      height: 3px;
      background: linear-gradient(
        to right,
        var(--eu-yellow),
        var(--eu-yellow),
        transparent 32%,
        transparent 68%,
        var(--eu-yellow),
        var(--eu-yellow)
      );
    }

    .app-header {
      display: flex;
      flex-direction: column;
      border-bottom: 1px solid var(--border-subtle);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
      background:
        radial-gradient(circle at top left, rgba(0, 68, 148, 0.6), transparent 50%),
        linear-gradient(to right, #020817, #030f2e);
      backdrop-filter: blur(18px);
      z-index: 10;
    }

    .app-header-main {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px 6px;
    }

    .app-header-sub {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px 10px;
      font-size: 10px;
      color: var(--text-soft);
      border-top: 1px solid rgba(15, 23, 42, 0.65);
      background: linear-gradient(to right, rgba(1, 8, 23, 0.9), rgba(5, 19, 49, 0.85));
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-emblem {
      width: 40px;
      height: 26px;
      border-radius: 3px;
      border: 1px solid rgba(15, 23, 42, 0.7);
      background:
        radial-gradient(circle at 50% 15%, rgba(255, 255, 255, 0.25), transparent 55%),
        linear-gradient(to bottom, var(--eu-blue), #00307a);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .brand-emblem-stars {
      font-size: 11px;
      color: var(--eu-yellow);
      letter-spacing: 0.04em;
    }

    .brand-text-title {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .brand-text-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    .badge-strip {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 11px;
    }

    .badge {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.65);
      background: rgba(4, 15, 39, 0.96);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.25);
    }

    .badge-pill {
      background: var(--accent-soft);
      border-color: rgba(0, 68, 148, 0.8);
      color: #e5f0ff;
    }

    .user-pill {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(4, 15, 39, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.65);
    }

    .user-avatar {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #ffffff, #ffd617);
      color: #00113b;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
    }

    .user-meta {
      display: flex;
      flex-direction: column;
      font-size: 11px;
      color: var(--text-muted);
    }

    .user-meta span:first-child {
      color: var(--text-main);
    }

    .header-sub-left {
      display: flex;
      align-items: center;
      gap: 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .header-sub-badges {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .header-sub-badge {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(4, 15, 39, 0.9);
      color: var(--text-soft);
      font-size: 10px;
    }

    /*****************************************************
     * MAIN LAYOUT GRID
     *****************************************************/
    .layout-main {
      flex: 1;
      display: grid;
      grid-template-columns: 270px 1fr 1.15fr;
      gap: 12px;
      padding: 12px;
      max-height: calc(100vh - 84px);
    }

    .panel {
      background: radial-gradient(circle at top left, var(--panel-bg-alt), var(--eu-blue-deep));
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 14px;
      display: flex;
      flex-direction: column;
      min-height: 0;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(0, 68, 148, 0.16), transparent 60%),
        radial-gradient(circle at 120% 120%, rgba(0, 68, 148, 0.12), transparent 60%);
      opacity: 0.85;
      pointer-events: none;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      flex: 1;
    }

    .panel h2 {
      margin: 0 0 6px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .panel h2 span {
      font-size: 11px;
      font-weight: 500;
      color: var(--text-muted);
      letter-spacing: 0.04em;
      text-transform: none;
    }

    /*****************************************************
     * SIDEBAR – EXPERIENCE SETUP
     *****************************************************/
    .sidebar-section {
      margin-top: 10px;
    }

    .sidebar-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
      margin-bottom: 5px;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 11px;
      color: var(--text-soft);
      background: rgba(4, 15, 39, 0.94);
      cursor: pointer;
      transition: 0.16s all ease-out;
      white-space: nowrap;
    }

    .chip:hover {
      border-color: var(--border-strong);
      transform: translateY(-1px);
    }

    .chip.chip-active {
      background: linear-gradient(to right, var(--eu-blue), var(--eu-blue-dark));
      border-color: transparent;
      color: #e5f0ff;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.8);
    }

    .status-pill {
      margin-top: 8px;
      padding: 5px 9px;
      border-radius: 999px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(22, 163, 74, 0.12);
      border: 1px solid rgba(34, 197, 94, 0.5);
      color: #bbf7d0;
    }

    .status-pill svg {
      width: 13px;
      height: 13px;
    }

    .sidebar-note {
      margin-top: 4px;
      font-size: 10px;
      color: var(--text-soft);
      line-height: 1.45;
    }

    /*****************************************************
     * CENTER – CHAT ONLY
     *****************************************************/
    .chat-panel {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .chat-header {
      margin-bottom: 2px;
    }

    .chat-header-title {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .chat-header-sub {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 4px;
    }

    .chat-body {
      flex: 1;
      overflow-y: auto;
      margin-top: 4px;
      padding: 8px 6px 6px;
      border-radius: 14px;
      background:
        radial-gradient(circle at top left, rgba(0, 68, 148, 0.24), transparent 52%),
        radial-gradient(circle at bottom right, rgba(15, 23, 42, 0.9), #020617);
      border: 1px solid rgba(15, 23, 42, 0.9);
    }

    .message-group {
      margin-bottom: 10px;
    }

    .message-meta {
      font-size: 10px;
      color: var(--text-soft);
      margin-bottom: 3px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .message-meta span:first-child {
      font-weight: 500;
      color: var(--text-muted);
    }

    .message-bubble {
      max-width: 100%;
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 12px;
      line-height: 1.45;
      border: 1px solid rgba(15, 23, 42, 0.9);
      background: rgba(4, 15, 39, 0.96);
    }

    .message-bubble.assistant {
      background: linear-gradient(135deg, rgba(0, 68, 148, 0.22), rgba(4, 15, 39, 0.98));
      border-color: rgba(0, 68, 148, 0.9);
    }

    .chat-input-area {
      border-radius: 14px;
      padding: 7px 9px;
      background: rgba(4, 15, 39, 0.96);
      border: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }

    .chat-input-row {
      display: flex;
      gap: 8px;
      align-items: flex-end;
    }

    .chat-input {
      flex: 1;
      border-radius: 10px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background:
        radial-gradient(circle at top left, rgba(0, 68, 148, 0.25), rgba(4, 15, 39, 0.98));
      color: var(--text-main);
      padding: 7px 10px;
      font-size: 12px;
      resize: none;
      max-height: 80px;
      outline: none;
    }

    .chat-input::placeholder {
      color: var(--text-soft);
    }

    .btn-send {
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      background: linear-gradient(to right, var(--eu-blue), var(--eu-blue-dark));
      color: #f9fafb;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.85);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-send svg {
      width: 13px;
      height: 13px;
    }

    .chat-footnote {
      font-size: 10px;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-footnote span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /*****************************************************
     * STORY CANVAS PANEL (RIGHT)
     *****************************************************/
    .canvas-panel {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .canvas-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 2px;
    }

    .canvas-title {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .canvas-sub {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 3px;
      max-width: 320px;
    }

    .pill-ai-label {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: rgba(4, 15, 39, 0.96);
      font-size: 10px;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .pill-ai-label svg {
      width: 11px;
      height: 11px;
    }

    .canvas-body {
      flex: 1;
      border-radius: 14px;
      border: 1px solid rgba(15, 23, 42, 0.9);
      background:
        radial-gradient(circle at top right, rgba(0, 68, 148, 0.25), #020617);
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: hidden;
    }

    .canvas-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 10px;
      color: var(--text-soft);
      padding: 2px 2px 4px;
      gap: 8px;
    }

    .canvas-meta-row span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .canvas-meta-badges {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .meta-badge {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(4, 15, 39, 0.9);
      font-size: 9px;
      color: var(--text-soft);
    }

    .canvas-scroll {
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
      margin-top: 2px;
    }

    .canvas-card {
      padding: 8px 9px;
      border-radius: 12px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: rgba(4, 15, 39, 0.97);
      margin-bottom: 7px;
      font-size: 12px;
    }

    .canvas-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .canvas-card-title {
      font-size: 12px;
      font-weight: 600;
    }

    .canvas-card-sub {
      font-size: 10px;
      color: var(--text-soft);
    }

    .canvas-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 6px;
    }

    .tag {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 9px;
      color: var(--text-soft);
    }

    .tag-accent {
      border-color: rgba(0, 68, 148, 0.95);
      color: #dbeafe;
      background: rgba(0, 68, 148, 0.22);
    }

    .hint-bar {
      font-size: 10px;
      color: var(--text-soft);
      padding-top: 4px;
      border-top: 1px dashed rgba(55, 65, 81, 0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .hint-bar span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /*****************************************************
     * DASHBOARD MOCKUP
     *****************************************************/
    .dash-card {
      margin-top: 2px;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: radial-gradient(circle at top, rgba(0, 68, 148, 0.22), rgba(4, 15, 39, 0.97));
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .dash-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      gap: 8px;
    }

    .dash-header-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .dash-title {
      font-size: 12px;
      font-weight: 600;
    }

    .dash-subtitle {
      font-size: 10px;
      color: var(--text-soft);
    }

    .dash-header-right {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .dash-filter {
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 10px;
      background: rgba(4, 15, 39, 0.95);
      color: var(--text-soft);
    }

    .dash-body {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 8px;
      margin-top: 4px;
    }

    .dash-map-mini {
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: radial-gradient(circle at top, rgba(22, 163, 74, 0.12), rgba(4, 15, 39, 0.9));
      padding: 6px;
      position: relative;
      font-size: 9px;
      color: var(--text-soft);
    }

    .dash-map-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .dash-map-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 2px;
      margin-top: 6px;
    }

    .dash-cell {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 2px;
      background: rgba(15, 23, 42, 0.9);
    }

    .dash-cell.high { background: #b91c1c; }
    .dash-cell.medium { background: #f97316; }
    .dash-cell.low { background: #22c55e; }

    .dash-kpis {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
    }

    .kpi {
      padding: 5px;
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(4, 15, 39, 0.9);
      font-size: 10px;
    }

    .kpi-label {
      color: var(--text-soft);
      margin-bottom: 2px;
    }

    .kpi-value {
      font-size: 13px;
      font-weight: 600;
    }

    .kpi-trend {
      font-size: 10px;
      color: #bbf7d0;
    }

    .kpi-trend.down {
      color: #fecaca;
    }

    .dash-chart {
      margin-top: 4px;
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(4, 15, 39, 0.94);
      padding: 4px 6px 6px;
      font-size: 9px;
      color: var(--text-soft);
    }

    .chart-bars {
      display: flex;
      align-items: flex-end;
      gap: 4px;
      height: 48px;
      margin-top: 4px;
    }

    .chart-bar {
      flex: 1;
      border-radius: 3px 3px 0 0;
      background: linear-gradient(to top, rgba(248, 113, 113, 0.9), rgba(251, 191, 36, 0.8));
    }

    .chart-bar.low {
      background: linear-gradient(to top, rgba(52, 211, 153, 0.8), rgba(56, 189, 248, 0.8));
    }

    .chart-x-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 2px;
    }

    .chart-x-labels span {
      font-size: 8px;
      color: var(--text-soft);
    }

    .dash-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
      font-size: 9px;
      color: var(--text-soft);
      gap: 6px;
    }

    .dash-export {
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(4, 15, 39, 0.95);
      cursor: pointer;
      font-size: 9px;
      white-space: nowrap;
    }

    /*****************************************************
     * ANIMATION PLAYER MOCKUP
     *****************************************************/
    .video-layout {
      display: grid;
      grid-template-columns: 1.05fr 1fr;
      gap: 8px;
      margin-top: 4px;
    }

    .video-player {
      border-radius: 10px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background:
        radial-gradient(circle at top left, rgba(37, 99, 235, 0.25), transparent 55%),
        radial-gradient(circle at bottom right, rgba(8, 47, 73, 0.5), #020617);
      padding: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 10px;
    }

    .video-frame {
      position: relative;
      border-radius: 8px;
      background: linear-gradient(135deg, #0f172a, #0369a1);
      height: 118px;
      overflow: hidden;
    }

    .video-play-btn {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 30px;
      height: 30px;
      border-radius: 999px;
      border: 1px solid rgba(248, 250, 252, 0.9);
      background: rgba(15, 23, 42, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .video-play-btn::before {
      content: "";
      border-style: solid;
      border-width: 6px 0 6px 9px;
      border-color: transparent transparent transparent #e5e7eb;
      margin-left: 1px;
    }

    .video-caption-overlay {
      position: absolute;
      left: 8px;
      bottom: 8px;
      padding: 3px 6px;
      border-radius: 999px;
      background: rgba(4, 15, 39, 0.9);
      color: #e5e7eb;
      font-size: 9px;
    }

    .video-timeline {
      height: 4px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      overflow: hidden;
    }

    .video-progress {
      height: 100%;
      width: 30%;
      background: linear-gradient(to right, var(--eu-yellow), #fb923c);
    }

    .video-meta {
      display: flex;
      justify-content: space-between;
      font-size: 9px;
      color: var(--text-soft);
    }

    .storyboard-list {
      margin-top: 4px;
      font-size: 11px;
      padding-left: 16px;
    }

    .storyboard-list li {
      margin-bottom: 2px;
    }

    .storyboard-list li.current {
      color: #e5e7eb;
      font-weight: 500;
    }

    .storyboard-controls {
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
    }

    .storyboard-btn {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(4, 15, 39, 0.96);
      color: var(--text-muted);
      cursor: pointer;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: 0.16s all ease-out;
    }

    .storyboard-btn:hover {
      border-color: var(--border-strong);
      transform: translateY(-1px);
    }

    .storyboard-step-indicator {
      font-size: 11px;
      color: var(--text-soft);
    }

    /*****************************************************
     * MAP WIDGET
     *****************************************************/
    .map-widget {
      margin-top: 4px;
      border-radius: 10px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: radial-gradient(circle at top, #022c22, #050f27);
      padding: 8px;
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 8px;
    }

    .map-viewport {
      position: relative;
      border-radius: 8px;
      background: linear-gradient(145deg, #022c22, #020617);
      overflow: hidden;
      min-height: 150px;
    }

    .map-viewport::before {
      content: "";
      position: absolute;
      inset: 10%;
      border-radius: 40% 60% 55% 45%;
      border: 1px solid rgba(148, 163, 184, 0.4);
      opacity: 0.6;
    }

    .map-viewport::after {
      content: "";
      position: absolute;
      inset: 24%;
      border-radius: 45% 55% 50% 50%;
      border: 1px dashed rgba(148, 163, 184, 0.5);
      opacity: 0.5;
    }

    .map-title-overlay {
      position: absolute;
      top: 6px;
      left: 8px;
      padding: 3px 7px;
      font-size: 10px;
      border-radius: 999px;
      background: rgba(4, 15, 39, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #e5e7eb;
    }

    .map-corridor {
      position: absolute;
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.9);
      background: rgba(0, 68, 148, 0.92);
      color: #dbeafe;
      font-size: 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: 0.16s all ease-out;
    }

    .map-corridor::before {
      content: "";
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--eu-yellow);
    }

    .map-corridor:hover {
      transform: translateY(-1px) scale(1.02);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.7);
    }

    .map-corridor.active {
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.9);
      background: linear-gradient(to right, var(--eu-blue), var(--eu-blue-dark));
    }

    .map-legend {
      position: absolute;
      right: 6px;
      bottom: 6px;
      padding: 4px 6px;
      border-radius: 6px;
      background: rgba(4, 15, 39, 0.96);
      border: 1px solid rgba(75, 85, 99, 0.9);
      font-size: 9px;
      color: #9ca3af;
    }

    .map-legend-row {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .map-legend-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--eu-yellow);
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.7);
    }

    .map-details {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .map-details strong {
      color: #e5e7eb;
    }

    .map-metric-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 5px;
    }

    .map-metric-pill {
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 10px;
      color: #cbd5f5;
      background: rgba(4, 15, 39, 0.8);
    }

    /*****************************************************
     * SOCIAL MEDIA MOCKUP
     *****************************************************/
    .social-layout {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 8px;
      margin-top: 4px;
    }

    .social-post-card {
      border-radius: 10px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(4, 15, 39, 0.97);
      padding: 8px;
      font-size: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .social-header {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .social-avatar {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #ffffff, #93c5fd);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      color: #00113b;
    }

    .social-name {
      font-weight: 600;
      font-size: 10px;
    }

    .social-handle {
      font-size: 9px;
      color: var(--text-soft);
    }

    .social-image {
      border-radius: 8px;
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.35), transparent 60%),
        radial-gradient(circle at bottom right, rgba(22, 163, 74, 0.55), #020617);
      height: 90px;
      position: relative;
      overflow: hidden;
    }

    .social-image-label {
      position: absolute;
      left: 6px;
      bottom: 6px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(4, 15, 39, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 9px;
    }

    .social-footer {
      display: flex;
      justify-content: space-between;
      font-size: 9px;
      color: var(--text-soft);
      gap: 4px;
    }

    .social-tiles-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
    }

    .social-tile {
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(4, 15, 39, 0.96);
      padding: 6px;
      font-size: 9px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .tile-title {
      font-weight: 600;
    }

    .tile-tag {
      display: inline-block;
      padding: 2px 5px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 8px;
      color: var(--text-soft);
    }

    /*****************************************************
     * SCROLLBARS
     *****************************************************/
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(4, 15, 39, 0.9);
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(75, 85, 99, 0.8);
      border-radius: 999px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(148, 163, 184, 0.95);
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- EU RIBBON -->
    <div class="header-ribbon"></div>

    <!-- HEADER -->
    <header class="app-header">
      <div class="app-header-main">
        <div class="brand">
          <div class="brand-emblem">
            <div class="brand-emblem-stars">★EU</div>
          </div>
          <div>
            <div class="brand-text-title">Insight Engine Assistant</div>
            <div class="brand-text-subtitle">AI-powered EU space-data storytelling for policy, diplomacy and citizens</div>
          </div>
        </div>

        <div class="badge-strip">
          <div class="badge">
            <div class="badge-dot"></div>
            Prototype · Desktop
          </div>
          <div class="badge badge-pill">
            Copernicus · Galileo · EGNOS · GOVSATCOM · IRIS²
          </div>
          <div class="user-pill">
            <div class="user-avatar">EU</div>
            <div class="user-meta">
              <span>Policy Panel Mode</span>
              <span>Scenario: Delegation communication brief</span>
            </div>
          </div>
        </div>
      </div>

      <div class="app-header-sub">
        <div class="header-sub-left">
          <strong>Mission</strong>
          <span>Turn EU space data into creative, multilingual content accessible to everyone.</span>
        </div>
        <div class="header-sub-badges">
          <span class="header-sub-badge">AI Act-aligned</span>
          <span class="header-sub-badge">GDPR · Data sovereignty</span>
          <span class="header-sub-badge">Green compute (PUE ≤ 1.4)</span>
        </div>
      </div>
    </header>

    <!-- MAIN LAYOUT -->
    <main class="layout-main">
      <!-- LEFT: EXPERIENCE SETUP (UNCHANGED) -->
      <section class="panel">
        <div class="panel-inner">
          <h2>
            Experience setup
            <span>Format · Region · Audience</span>
          </h2>

          <div class="sidebar-section">
            <div class="sidebar-label">Experience type</div>
            <div class="chip-row" id="experienceRow">
              <button class="chip chip-active">Interactive Dashboard</button>
              <button class="chip">Animated Short Film</button>
              <button class="chip">Immersive Map</button>
              <button class="chip">Social Media Pack</button>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-label">Geography / use case</div>
            <div class="chip-row" id="useCaseRow">
              <button class="chip chip-active">Amazon · Deforestation</button>
              <button class="chip">Mozambique · Cyclone response</button>
              <button class="chip">Africa · Clean-energy corridors</button>
              <button class="chip">Global · Daily EU impact</button>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-label">Programme focus</div>
            <div class="chip-row" id="programmeFocusRow">
              <button class="chip chip-active">Copernicus</button>
              <button class="chip">Galileo</button>
              <button class="chip">Mixed (Copernicus + Galileo)</button>
              <button class="chip">Full suite (incl. IRIS²)</button>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-label">Target audience</div>
            <div class="chip-row" id="audienceRow">
              <button class="chip chip-active">EU Delegations</button>
              <button class="chip">Schools / Students</button>
              <button class="chip">Journalists / Media</button>
              <button class="chip">Citizens (general)</button>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-label">Language (example labels)</div>
            <div class="chip-row" id="languageRow">
              <button class="chip chip-active">EN</button>
              <button class="chip">FR</button>
              <button class="chip">PT</button>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-label">Governance</div>
            <div class="status-pill">
              <svg viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="rgba(34,197,94,0.5)" stroke-width="1.5" />
                <path d="M8 12.5L10.5 15L16 9" stroke="#22c55e" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              Compliant · AI Act &amp; GDPR
            </div>
            <div class="sidebar-note">
              Federated data handling, human review for narratives, hosted in EU data centres with monitored energy footprint.
            </div>
          </div>
        </div>
      </section>

      <!-- CENTER: CHAT ONLY (NO OUTPUT MOCKUPS) -->
      <section class="panel chat-panel">
        <div class="panel-inner">
          <div class="chat-header">
            <div class="chat-header-title">Conversational workspace</div>
            <div class="chat-header-sub">
              Describe what you need. The assistant uses EU space data to configure the experience (dashboard, film, map, or social pack). The visual result appears on the right.
            </div>
          </div>

          <div class="chat-body" id="chatBody"></div>

          <div class="chat-input-area">
            <div class="chat-input-row">
              <textarea
                id="chatInput"
                class="chat-input"
                rows="2"
                placeholder="Example: “Design a Copernicus dashboard on real-time deforestation alerts in the Amazon for Delegations and journalists.”"
              ></textarea>
              <button class="btn-send" id="sendBtn">
                <span>Generate</span>
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M4 19L20 12L4 5L4 11L14 12L4 13L4 19Z" fill="currentColor" />
                </svg>
              </button>
            </div>
            <div class="chat-footnote">
              <span>ⓘ <span>AI-assisted · Human review required before external dissemination.</span></span>
              <span>Mode: <strong>Prototype · Internal</strong></span>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT: STORY CANVAS – ONLY OUTPUT DEPENDING ON LEFT CONTROLS -->
      <section class="panel canvas-panel">
        <div class="panel-inner">
          <div class="canvas-header">
            <div>
              <div class="canvas-title">Story canvas</div>
              <div class="canvas-sub">
                Concrete example of the output currently configured on the left – dashboard, short film, immersive map or social pack.
              </div>
            </div>
            <div class="pill-ai-label">
              <svg viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="9" stroke="rgba(148,163,184,0.7)" stroke-width="1.4" />
                <path d="M9.5 10.2C9.5 8.9 10.4 8 11.8 8C13.1 8 14 8.8 14 9.9C14 10.8 13.5 11.4 12.7 11.8L12.5 11.9C11.9 12.2 11.7 12.5 11.7 13.1V13.4" stroke="#e5e7eb" stroke-width="1.4" stroke-linecap="round" />
                <circle cx="11.8" cy="15.3" r="0.9" fill="#e5e7eb" />
              </svg>
              AI-generated · Human-reviewed
            </div>
          </div>

          <div class="canvas-body">
            <div class="canvas-meta-row">
              <span>
                Scenario:
                <span id="canvasScenarioSummary">Dashboard · Amazon · Copernicus · EU Delegations</span>
              </span>
              <div class="canvas-meta-badges">
                <div class="meta-badge">AI Act · risk-based</div>
                <div class="meta-badge">Transparency label</div>
                <div class="meta-badge">Official EU space data</div>
              </div>
            </div>

            <div class="canvas-scroll" id="canvasContent"></div>

            <div class="hint-bar">
              <span>Change the experience type, region or audience on the left – this preview updates automatically.</span>
              <span>Designed for web, briefings and Delegation sites.</span>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    /*****************************************************
     * SIMPLE POLICY CONTEXT STRING
     *****************************************************/
    const basePolicyIdeas =
      "Insight Engine is a joint EUSPA–EEAS AI storytelling platform that turns Copernicus, Galileo, EGNOS, GOVSATCOM and IRIS² data into multilingual narratives, visuals and communication products. " +
      "It is aligned with the AI Act, GDPR and data-sovereignty requirements, and uses green computing. " +
      "The objective is to strengthen EU foreign policy, strategic communication and downstream industry by making space-data visible, human-centred and democratic.";

    /*****************************************************
     * DOM REFERENCES
     *****************************************************/
    const chatBody = document.getElementById("chatBody");
    const chatInput = document.getElementById("chatInput");
    const sendBtn = document.getElementById("sendBtn");
    const canvasContent = document.getElementById("canvasContent");
    const canvasScenarioSummary = document.getElementById("canvasScenarioSummary");

    let activeTab = "dashboard"; // controlled by left-side Experience type

    /*****************************************************
     * CHAT (TEXT ONLY, NO VISUAL OUTPUTS HERE)
     *****************************************************/
    function appendMessage(author, text) {
      const group = document.createElement("div");
      group.className = "message-group";

      const meta = document.createElement("div");
      meta.className = "message-meta";
      const who = document.createElement("span");
      who.textContent = author === "user" ? "You" : "Insight Engine";
      const mode = document.createElement("span");
      mode.textContent = author === "user" ? "Prompt" : "Prototype response";
      meta.appendChild(who);
      meta.appendChild(mode);

      const bubble = document.createElement("div");
      bubble.className = "message-bubble" + (author === "assistant" ? " assistant" : "");
      bubble.innerHTML = text;

      group.appendChild(meta);
      group.appendChild(bubble);
      chatBody.appendChild(group);
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    function initialMessages() {
      appendMessage(
        "assistant",
        "<strong>Welcome.</strong> Use the controls on the left to choose a format (dashboard, film, map, social pack), region and audience. " +
        "Then describe your needs in natural language – the Story Canvas on the right shows a concrete example of the configured output."
      );
      appendMessage(
        "user",
        "Show how the Insight Engine could present Copernicus deforestation alerts in the Amazon for EU Delegations."
      );
      appendMessage(
        "assistant",
        "Understood. Based on the current setup, the canvas displays an interactive dashboard mock-up for Amazon deforestation alerts. " +
        "In a live system, this would be populated with real Copernicus data and export-ready assets for Delegations."
      );
    }
    initialMessages();

    function getActiveChipLabel(id) {
      const row = document.getElementById(id);
      if (!row) return null;
      const active = row.querySelector(".chip-active");
      return active ? active.textContent.trim() : null;
    }

    function generateAssistantResponse(userText) {
      const experience = getActiveChipLabel("experienceRow") || "Interactive Dashboard";
      const useCase = getActiveChipLabel("useCaseRow") || "Global · Daily EU impact";
      const programme = getActiveChipLabel("programmeFocusRow") || "Copernicus";
      const audience = getActiveChipLabel("audienceRow") || "EU Delegations";

      return (
        "<strong>Configured experience:</strong> " +
        experience +
        " · " +
        useCase +
        " · " +
        programme +
        " · " +
        audience +
        "<br/><br/>" +
        "The Story Canvas on the right reflects this configuration with a visual prototype (no real data yet). " +
        "In an operational version, this output would be downloadable and localisable for Delegations, schools, journalists and citizens.<br/><br/>" +
        "<strong>Policy backbone:</strong> " +
        basePolicyIdeas
      );
    }

    function handleSend() {
      const text = chatInput.value;
      if (!text.trim()) return;
      appendMessage("user", text);
      const response = generateAssistantResponse(text);
      appendMessage("assistant", response);
      chatInput.value = "";
      updateCanvas();
    }

    sendBtn.addEventListener("click", handleSend);
    chatInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    });

    /*****************************************************
     * CHIP SETUP (LEFT CONTROLS)
     *****************************************************/
    function setupChipRow(id, onClickExtra) {
      const row = document.getElementById(id);
      if (!row) return;
      row.addEventListener("click", (e) => {
        if (e.target.classList.contains("chip")) {
          [...row.querySelectorAll(".chip")].forEach((chip) => chip.classList.remove("chip-active"));
          e.target.classList.add("chip-active");
          if (onClickExtra) onClickExtra(e.target.textContent.trim());
          updateCanvas();
        }
      });
    }

    function activateChip(rowId, startsWith) {
      const row = document.getElementById(rowId);
      if (!row) return;
      [...row.querySelectorAll(".chip")].forEach((chip) => {
        if (chip.textContent.trim().startsWith(startsWith)) chip.classList.add("chip-active");
        else chip.classList.remove("chip-active");
      });
    }

    // Experience row controls which output template is shown on the right
    setupChipRow("experienceRow", (label) => {
      if (label.startsWith("Interactive Dashboard")) activeTab = "dashboard";
      else if (label.startsWith("Animated Short Film")) activeTab = "animation";
      else if (label.startsWith("Immersive Map")) activeTab = "map";
      else if (label.startsWith("Social Media Pack")) activeTab = "social";
    });

    setupChipRow("useCaseRow");
    setupChipRow("programmeFocusRow");
    setupChipRow("audienceRow");
    setupChipRow("languageRow");

    /*****************************************************
     * LANGUAGE LABELS
     *****************************************************/
    function getLabelForLanguage(key, lang) {
      const dict = {
        todayFromSpace: {
          EN: "Today from space",
          FR: "Aujourd’hui depuis l’espace",
          PT: "Hoje desde o espaço",
        },
        learnMore: {
          EN: "Learn more",
          FR: "En savoir plus",
          PT: "Saiba mais",
        },
        poweredByEU: {
          EN: "Powered by EU space data",
          FR: "Propulsé par les données spatiales de l’UE",
          PT: "Impulsionado por dados espaciais da UE",
        },
      };
      return (dict[key] && dict[key][lang]) || dict[key]["EN"];
    }

    /*****************************************************
     * CANVAS RENDERERS
     *****************************************************/
    function updateScenarioSummary() {
      const exp = getActiveChipLabel("experienceRow") || "Dashboard";
      const useCase = getActiveChipLabel("useCaseRow") || "Global";
      const prog = getActiveChipLabel("programmeFocusRow") || "Copernicus";
      const audience = getActiveChipLabel("audienceRow") || "EU Delegations";
      canvasScenarioSummary.textContent = exp + " · " + useCase + " · " + prog + " · " + audience;
    }

    function renderDashboardTab(useCase, programme, audience, language) {
      const card = document.createElement("div");
      card.className = "canvas-card";
      const isAmazon = useCase.includes("Amazon");
      const todayLabel = getLabelForLanguage("todayFromSpace", language);

      card.innerHTML =
        '<div class="canvas-card-header">' +
        '<div>' +
        '<div class="canvas-card-title">Interactive dashboard' +
        (isAmazon ? " · Amazon deforestation alerts" : "") +
        "</div>" +
        '<div class="canvas-card-sub">Embedded on EUSPA / EEAS portals and Delegation sites.</div>' +
        "</div>" +
        '<span class="canvas-card-sub">' +
        programme +
        "</span>" +
        "</div>";

      const dash = document.createElement("div");
      dash.className = "dash-card";

      dash.innerHTML =
        '<div class="dash-header">' +
        '<div class="dash-header-left">' +
        '<div class="dash-title">' +
        todayLabel +
        "</div>" +
        '<div class="dash-subtitle">' +
        (isAmazon ? "Real-time deforestation alerts in the Amazon basin" : "Live environmental indicators") +
        "</div>" +
        "</div>" +
        '<div class="dash-header-right">' +
        '<div class="dash-filter">Time: 24h ▾</div>' +
        '<div class="dash-filter">Audience: ' +
        audience +
        "</div>" +
        "</div>" +
        "</div>" +
        '<div class="dash-body">' +
        '<div class="dash-map-mini">' +
        '<div class="dash-map-header">' +
        "<span>Alert density map</span>" +
        "<span style='font-size:8px;'>High ▪ Medium ▪ Low</span>" +
        "</div>" +
        '<div class="dash-map-grid" id="dashMapGrid"></div>' +
        "</div>" +
        '<div class="dash-kpis">' +
        '<div class="kpi">' +
        '<div class="kpi-label">Active alerts</div>' +
        '<div class="kpi-value">128</div>' +
        '<div class="kpi-trend">+12 vs. yesterday</div>' +
        "</div>" +
        '<div class="kpi">' +
        '<div class="kpi-label">Area at risk</div>' +
        '<div class="kpi-value">3 240 km²</div>' +
        '<div class="kpi-trend down">−5% vs. last week</div>' +
        "</div>" +
        "</div>" +
        "</div>" +
        '<div class="dash-chart">' +
        "<div>Trend over last 7 days</div>" +
        '<div class="chart-bars">' +
        '<div class="chart-bar" style="height:35%;"></div>' +
        '<div class="chart-bar" style="height:60%;"></div>' +
        '<div class="chart-bar" style="height:45%;"></div>' +
        '<div class="chart-bar low" style="height:30%;"></div>' +
        '<div class="chart-bar" style="height:70%;"></div>' +
        '<div class="chart-bar" style="height:55%;"></div>' +
        '</div>' +
        '<div class="chart-x-labels">' +
        "<span>Day 1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span>" +
        "</div>" +
        "</div>" +
        '<div class="dash-footer">' +
        "<span>Data: " +
        programme +
        " (prototype). Captions and filters localised in " +
        language +
        ".</span>" +
        '<button class="dash-export">Export snapshot</button>' +
        "</div>";

      card.appendChild(dash);

      const tags = document.createElement("div");
      tags.className = "canvas-tag-row";
      ["Dashboard", programme, useCase, audience].forEach((label, idx) => {
        const t = document.createElement("span");
        t.className = "tag" + (idx < 2 ? " tag-accent" : "");
        t.textContent = label;
        tags.appendChild(t);
      });
      card.appendChild(tags);

      canvasContent.appendChild(card);

      const grid = card.querySelector("#dashMapGrid");
      if (grid) {
        const pattern = ["high", "medium", "low", "medium", "high", "low"];
        for (let i = 0; i < 24; i++) {
          const cell = document.createElement("div");
          cell.className = "dash-cell " + pattern[i % pattern.length];
          grid.appendChild(cell);
        }
      }
    }

    function renderAnimationTab(useCase, programme, audience, language) {
      const card = document.createElement("div");
      card.className = "canvas-card";
      const learnMoreLabel = getLabelForLanguage("learnMore", language);

      card.innerHTML =
        '<div class="canvas-card-header">' +
        '<div>' +
        '<div class="canvas-card-title">Animated short film · Humanitarian convoys</div>' +
        '<div class="canvas-card-sub">A 60–90s explainer embedded on EU or Delegation pages.</div>' +
        "</div>" +
        '<span class="canvas-card-sub">' +
        programme +
        "</span>" +
        "</div>";

      const layout = document.createElement("div");
      layout.className = "video-layout";

      const player = document.createElement("div");
      player.className = "video-player";
      player.innerHTML =
        '<div class="video-frame">' +
        '<div class="video-play-btn" title="Play"></div>' +
        '<div class="video-caption-overlay">Cyclone response · ' +
        programme +
        "</div>" +
        "</div>" +
        '<div class="video-timeline"><div class="video-progress"></div></div>' +
        '<div class="video-meta"><span>0:12 / 1:10</span><span>Subtitles: ' +
        language +
        "</span></div>" +
        "<div>Caption example: “Convoys use satellite-based navigation to reach isolated communities safely.”</div>";

      const storyboard = document.createElement("div");
      storyboard.innerHTML =
        "<div style='font-size:11px;font-weight:600;margin-bottom:3px;'>Storyboard scenes</div>" +
        "<ul class='storyboard-list'>" +
        "<li data-step='1'>Opening: satellite view of the cyclone and affected region.</li>" +
        "<li data-step='2'>Signal from space: satellites provide precise positioning and timing.</li>" +
        "<li data-step='3'>Convoy coordination: safe routes and supply hubs appear on the map.</li>" +
        "<li data-step='4'>EU role: EU and partner logos as overlays.</li>" +
        "<li data-step='5'>Closing: “" +
        learnMoreLabel +
        "” + link to a data-rich EU page.</li>" +
        "</ul>" +
        '<div class="storyboard-controls">' +
        '<button class="storyboard-btn">▶ Next scene</button>' +
        '<span class="storyboard-step-indicator">Current scene: 1 / 5</span>' +
        "</div>";

      layout.appendChild(player);
      layout.appendChild(storyboard);
      card.appendChild(layout);

      const tags = document.createElement("div");
      tags.className = "canvas-tag-row";
      [
        "Animated film",
        programme.includes("Galileo") ? "Galileo" : "Navigation services",
        useCase,
        audience,
      ].forEach((label, idx) => {
        const t = document.createElement("span");
        t.className = "tag" + (idx < 2 ? " tag-accent" : "");
        t.textContent = label;
        tags.appendChild(t);
      });
      card.appendChild(tags);

      canvasContent.appendChild(card);

      const list = card.querySelector(".storyboard-list");
      const btn = card.querySelector(".storyboard-btn");
      const indicator = card.querySelector(".storyboard-step-indicator");
      let currentStep = 1;

      function updateStoryboardHighlight() {
        [...list.querySelectorAll("li")].forEach((li) => {
          const step = Number(li.dataset.step);
          li.classList.toggle("current", step === currentStep);
        });
        indicator.textContent = "Current scene: " + currentStep + " / 5";
      }
      updateStoryboardHighlight();

      btn.addEventListener("click", () => {
        currentStep = currentStep === 5 ? 1 : currentStep + 1;
        updateStoryboardHighlight();
      });
    }

    function renderMapTab(useCase, programme, audience, language) {
      const card = document.createElement("div");
      card.className = "canvas-card";

      card.innerHTML =
        '<div class="canvas-card-header">' +
        '<div>' +
        '<div class="canvas-card-title">Immersive map · Clean-energy corridors</div>' +
        '<div class="canvas-card-sub">Explorable map for Delegations and partner briefings.</div>' +
        "</div>" +
        '<span class="canvas-card-sub">' +
        programme +
        "</span>" +
        "</div>";

      const mapWidget = document.createElement("div");
      mapWidget.className = "map-widget";
      mapWidget.innerHTML =
        '<div class="map-viewport">' +
        '<div class="map-title-overlay">Africa · Clean-energy corridors</div>' +
        '<div class="map-corridor" data-id="sahel" style="top:40%;left:28%;">Sahel corridor</div>' +
        '<div class="map-corridor" data-id="east" style="top:55%;left:52%;">East Africa grid</div>' +
        '<div class="map-corridor" data-id="south" style="top:68%;left:42%;">Southern solar belt</div>' +
        '<div class="map-legend">' +
        '<div class="map-legend-row"><span class="map-legend-dot"></span> Clean-energy corridor</div>' +
        "</div>" +
        "</div>" +
        '<div class="map-details"></div>';

      card.appendChild(mapWidget);

      const tags = document.createElement("div");
      tags.className = "canvas-tag-row";
      ["Immersive map", "Africa", programme, audience].forEach((label, idx) => {
        const t = document.createElement("span");
        t.className = "tag" + (idx < 2 ? " tag-accent" : "");
        t.textContent = label;
        tags.appendChild(t);
      });
      card.appendChild(tags);

      canvasContent.appendChild(card);

      const corridors = card.querySelectorAll(".map-corridor");
      const details = card.querySelector(".map-details");

      const corridorData = {
        sahel: {
          title: "Sahel corridor",
          text:
            "Cross-border solar and transmission projects in the Sahel, supported by space-based land-use and climate-risk screening.",
          metrics: ["≈ 2.5M people reached", "≈ 1.2 MtCO₂ avoided / year", "EU support: grants + blending"],
        },
        east: {
          title: "East Africa grid",
          text:
            "Transmission lines and interconnectors mapped with satellite-derived demand, infrastructure and environmental constraints.",
          metrics: ["≈ 3.1M people reached", "≈ 1.8 MtCO₂ avoided / year", "EU support: technical assistance"],
        },
        south: {
          title: "Southern solar belt",
          text:
            "Utility-scale solar parks and grid upgrades informed by Copernicus solar resource and land-suitability layers.",
          metrics: ["≈ 4.0M people reached", "≈ 2.3 MtCO₂ avoided / year", "EU support: guarantees + investment"],
        },
      };

      function setActiveCorridor(id) {
        corridors.forEach((c) => c.classList.toggle("active", c.getAttribute("data-id") === id));
        const data = corridorData[id];
        if (!data) return;
        let html =
          "<strong>Selected corridor:</strong> " +
          data.title +
          "<br/>" +
          data.text +
          '<div class="map-metric-row">';
        data.metrics.forEach((m) => {
          html += '<div class="map-metric-pill">' + m + "</div>";
        });
        html += "</div>";
        details.innerHTML = html;
      }

      corridors.forEach((c) => {
        c.addEventListener("click", () => setActiveCorridor(c.getAttribute("data-id")));
      });

      setActiveCorridor("sahel");
    }

    function renderSocialTab(useCase, programme, audience, language) {
      const card = document.createElement("div");
      card.className = "canvas-card";
      const todayLabel = getLabelForLanguage("todayFromSpace", language);
      const poweredLabel = getLabelForLanguage("poweredByEU", language);

      card.innerHTML =
        '<div class="canvas-card-header">' +
        '<div>' +
        '<div class="canvas-card-title">Social-media pack · Daily EU contributions</div>' +
        '<div class="canvas-card-sub">Ready-to-use posts and tiles for Delegations, media and schools.</div>' +
        "</div>" +
        '<span class="canvas-card-sub">' +
        programme +
        "</span>" +
        "</div>";

      const layout = document.createElement("div");
      layout.className = "social-layout";

      const post = document.createElement("div");
      post.className = "social-post-card";
      post.innerHTML =
        '<div class="social-header">' +
        '<div class="social-avatar">EU</div>' +
        '<div>' +
        '<div class="social-name">EU Space – Insight Engine</div>' +
        '<div class="social-handle">@EU_Space • 6 min</div>' +
        "</div>" +
        "</div>" +
        "<div>" +
        todayLabel +
        ": satellite data show a rise in deforestation alerts in the Amazon. EU-supported projects help protect forests and communities." +
        "</div>" +
        '<div class="social-image">' +
        '<div class="social-image-label">' +
        poweredLabel +
        "</div>" +
        "</div>" +
        '<div class="social-footer">' +
        "<span>Data: " +
        programme +
        " (prototype)</span>" +
        "<span>♡ 124 · ⤴ 32</span>" +
        "</div>";

      const tiles = document.createElement("div");
      tiles.className = "social-tiles-grid";
      tiles.innerHTML =
        '<div class="social-tile">' +
        '<div class="tile-title">How EU space sees the forest</div>' +
        "<div>Copernicus monitors forest cover and flags sudden changes for authorities.</div>" +
        '<span class="tile-tag">Explainer</span>' +
        "</div>" +
        '<div class="social-tile">' +
        '<div class="tile-title">Why this matters locally</div>' +
        "<div>Deforestation affects rainfall, soil and livelihoods. Local partners use this data for action.</div>" +
        '<span class="tile-tag">Impact</span>' +
        "</div>" +
        '<div class="social-tile">' +
        '<div class="tile-title">EU in your region</div>' +
        "<div>Delegations can add local examples and links to EU-supported projects.</div>" +
        '<span class="tile-tag">Delegation</span>' +
        "</div>" +
        '<div class="social-tile">' +
        '<div class="tile-title">For classrooms</div>' +
        "<div>Teachers can switch to a simplified classroom version with activities.</div>" +
        '<span class="tile-tag">Education</span>' +
        "</div>";

      layout.appendChild(post);
      layout.appendChild(tiles);
      card.appendChild(layout);

      const tags = document.createElement("div");
      tags.className = "canvas-tag-row";
      ["Social pack", "Daily impact", programme, audience].forEach((label, idx) => {
        const t = document.createElement("span");
        t.className = "tag" + (idx < 2 ? " tag-accent" : "");
        t.textContent = label;
        tags.appendChild(t);
      });
      card.appendChild(tags);

      canvasContent.appendChild(card);
    }

    function updateCanvas() {
      const useCase = getActiveChipLabel("useCaseRow") || "Global · Daily EU impact";
      const programme = getActiveChipLabel("programmeFocusRow") || "Copernicus";
      const audience = getActiveChipLabel("audienceRow") || "EU Delegations";
      const language = getActiveChipLabel("languageRow") || "EN";

      updateScenarioSummary();
      canvasContent.innerHTML = "";

      if (activeTab === "dashboard") {
        renderDashboardTab(useCase, programme, audience, language);
      } else if (activeTab === "animation") {
        renderAnimationTab(useCase, programme, audience, language);
      } else if (activeTab === "map") {
        renderMapTab(useCase, programme, audience, language);
      } else if (activeTab === "social") {
        renderSocialTab(useCase, programme, audience, language);
      }
    }

    // Initial render
    updateCanvas();
  </script>
</body>
</html>
